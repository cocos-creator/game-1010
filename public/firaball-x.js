(function(){function _getPropertyDescriptor(a,b){if(a){var c=Object.getOwnPropertyDescriptor(a,b);return c||_getPropertyDescriptor(Object.getPrototypeOf(a),b)}}function _copyprop(a,b,c){var d=_getPropertyDescriptor(b,a);Object.defineProperty(c,a,d)}function _isDomNode(a){return"object"==typeof Node?a instanceof Node:a&&"object"==typeof a&&"number"==typeof a.nodeType&&"string"==typeof a.nodeName}function _initClass(a,b){for(var c in _metaClass)Object.defineProperty(b,c,{value:_metaClass[c],writable:"__props__"===c,enumerable:"__props__"===c})}function _defineFireClass(a,b,c){var d=_createCtor(c,b);return _initClass(a,d),b&&(JS.extend(d,b),d.$super=b,b.__props__&&(d.__props__=b.__props__.slice())),JS.setClassName(a,d),d}function _createCtor(a,b){var c;return c=a?b?function(){b.apply(this,arguments),_createInstanceProps(this,c),a.apply(this,arguments)}:function(){_createInstanceProps(this,c),a.apply(this,arguments)}:b?function(){b.apply(this,arguments),_createInstanceProps(this,c)}:function(){_createInstanceProps(this,c)}}function _getStyle(a){var b=emptyFont;a.bitmapFont&&a.bitmapFont.face&&(b={face:a.bitmapFont.face,size:a.bitmapFont.size,align:BitmapText.TextAlign[a.align]});var c={font:b.size+" "+b.face,align:b.align};return c}function _setStyle(a){var b=_getStyle(a);a._renderObj&&a._renderObj.setStyle(b),a._renderObjInScene&&a._renderObjInScene.setStyle(b)}function _getNewMatrix23(a,b){var c=new Fire.Matrix23;return c.a=a.scale.x,c.b=0,c.c=0,c.d=a.scale.y,c.tx=a.position.x,c.ty=-a.position.y,c.prepend(b),c.b=-c.b,c.c=-c.c,c.ty=Fire.Engine._curRenderContext.renderer.height-c.ty,c}function _registerFont(a){var b={};if(a&&a.face){b.font=a.face,b.size=a.size,b.lineHeight=a.lineHeight,b.chars={};for(var c=0,d=a.charInfos,e=d.length;e>c;c++){var f=d[c],g=f.id,h=new PIXI.Rectangle(f.x,f.y,f.width,f.height),i=null;if(a&&a.texture){var j=new PIXI.BaseTexture(a.texture.image);i=new PIXI.Texture(j,h)}b.chars[g]={xOffset:f.xOffset,yOffset:f.yOffset,xAdvance:f.xAdvance,kerning:{},texture:PIXI.TextureCache[g]=i}}var k=a.kernings;for(c=0;c<k.length;c++){var l=k[c],m=l.first,n=l.second,o=l.amount;b.chars[n].kerning[m]=o}}else b.font="None",b.size=1,b.lineHeight=1,b.chars={};PIXI.BitmapText.fonts[b.font]=b}function ImageLoader(a,b,c){var d=document.createElement("img");d.crossOrigin="Anonymous";var e=function(){b&&b(null,this),d.removeEventListener("load",e),d.removeEventListener("error",f),d.removeEventListener("progress",c)},f=function(a,g,h){if(b){var i="Failed to load image: "+a+" Url: "+h;b(i,null)}d.removeEventListener("load",e),d.removeEventListener("error",f),d.removeEventListener("progress",c)};return d.addEventListener("load",e),d.addEventListener("error",f),c&&d.addEventListener("progress",c),d.src=a,d}function _LoadFromXHR(a,b,c,d){var e=new XMLHttpRequest,f=-1;e.onreadystatechange=function(){e.readyState===e.DONE?(b&&(200===e.status||0===e.status?b(null,e):b('LoadFromXHR: Could not load "'+a+'", status: '+e.status,null)),e.onreadystatechange=null,g&&e.removeEventListener("progress",g)):(!c||e.readyState!==e.LOADING||"onprogress"in e||(-1===f&&(f=e.getResponseHeader("Content-Length")),c(e.responseText.length,f)),c&&e.readyState===e.HEADERS_RECEIVED&&(f=e.getResponseHeader("Content-Length")))},e.open("GET",a,!0),d&&(e.responseType=d);var g;c&&"onprogress"in e&&(g=function(a){a.lengthComputable&&c(a.loaded,a.total)},e.addEventListener("progress",onprogress)),e.send()}function TextLoader(a,b,c){var d=b&&function(c,d){d&&d.responseText?b(null,d.responseText):b('TextLoader: "'+a+'" seems to be unreachable or the file is empty. InnerMessage: '+c,null)};_LoadFromXHR(a,d,c)}function JsonLoader(a,b,c){var d=b&&function(c,d){if(d&&d.responseText){var e;try{e=JSON.parse(d.responseText)}catch(f){return void b(f,null)}b(null,e)}else b('JsonLoader: "'+a+'" seems to be unreachable or the file is empty. InnerMessage: '+c,null)};_LoadFromXHR(a,d,c)}function doDefineComp(a,b){var c=_requiringFrame[_requiringFrame.length-1];if(c){var d=c.script,e=Fire.extend(d,a,b);return c.uuid&&JS._setClassId(c.uuid,e),e}}var root=this,Fire=root.Fire||{};if(Fire.isNode=!("undefined"==typeof process||!process.versions||!process.versions.node),Fire.isNodeWebkit=!!(Fire.isNode&&"node-webkit"in process.versions),Fire.isAtomShell=!!(Fire.isNode&&"atom-shell"in process.versions),Fire.isApp=Fire.isNodeWebkit||Fire.isAtomShell,Fire.isPureWeb=!Fire.isNode&&!Fire.isApp,Fire.isEditor=Fire.isApp,Fire.isWeb=Fire.isAtomShell?"undefined"!=typeof process&&"renderer"===process.type:"undefined"==typeof __dirname||null===__dirname,Fire.isEditorCore=Fire.isApp&&!Fire.isWeb,Object.defineProperty(Fire,"isRetina",{get:function(){return Fire.isWeb&&window.devicePixelRatio&&window.devicePixelRatio>1}}),Fire.isNode)Fire.isDarwin="darwin"===process.platform,Fire.isWin32="win32"===process.platform;else{var platform=window.navigator.platform;Fire.isDarwin="Mac"===platform.substring(0,3),Fire.isWin32="Win"===platform.substring(0,3)}var Destroyed=1,ToDestroy=2,DontSave=4,EditorOnly=8,Dirty=16,ObjectFlags={DontSave:DontSave,EditorOnly:EditorOnly,Dirty:Dirty,Destroying:512,HideInGame:1024,HideInEditor:2048,IsOnEnableCalled:4096,IsOnLoadCalled:8192,IsOnStartCalled:16384};ObjectFlags.Hide=ObjectFlags.HideInGame|ObjectFlags.HideInEditor,Fire._ObjectFlags=ObjectFlags;var PersistentMask=~(ToDestroy|Dirty|ObjectFlags.Destroying|ObjectFlags.IsOnEnableCalled|ObjectFlags.IsOnLoadCalled|ObjectFlags.IsOnStartCalled),JS=Fire.JS={addon:function(a){"use strict";a=a||{};for(var b=1,c=arguments.length;c>b;b++){var d=arguments[b];for(var e in d)e in a||_copyprop(e,d,a)}return a},mixin:function(a){"use strict";a=a||{};for(var b=1,c=arguments.length;c>b;b++){var d=arguments[b];if(d){if("object"!=typeof d){Fire.error("Fire.mixin called on non-object:",d);continue}for(var e in d)_copyprop(e,d,a)}}return a},extend:function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a},clear:function(a){for(var b=Object.keys(a),c=0;c<b.length;c++)delete a[b[c]]}};JS.getClassName=function(a){if("function"==typeof a&&a.prototype.__classname__)return a.prototype.__classname__;if(a&&a.constructor){if(a.constructor.prototype&&a.constructor.prototype.hasOwnProperty("__classname__"))return a.__classname__;var b;if(a.constructor.name&&(b=a.constructor.name),a.constructor.toString){var c,d=a.constructor.toString();c=d.match("["===d.charAt(0)?/\[\w+\s*(\w+)\]/:/function\s*(\w+)/),c&&2===c.length&&(b=c[1])}return"Object"!==b?b:null}return null},function(){function a(a,b){return function(c,d){if(d.prototype.hasOwnProperty(a)&&delete b[d.prototype[a]],d.prototype[a]=c,c){var e=b[c];if(e&&e!==d){var f="A Class already exists with the same "+a+' : "'+c+'".';Fire.error(f)}else b[c]=d}}}var b={},c={};JS._setClassId=a("__cid__",b);var d=a("__classname__",c);JS.setClassName=function(a,b){d(a,b),a&&!b.prototype.hasOwnProperty("__cid__")&&JS._setClassId(a,b)},JS.unregisterClass=function(){"use strict";for(var a=0;a<arguments.length;a++){var d=arguments[a].prototype,e=d.__cid__;e&&delete b[e];var f=d.__classname__;f&&delete c[f]}},JS._getClassById=function(a){return b[a]},JS.getClassByName=function(a){return c[a]},JS._getClassId=function(a){return"function"==typeof a&&a.prototype.__cid__?a.prototype.__cid__:a&&a.constructor&&a.constructor.prototype&&a.constructor.prototype.hasOwnProperty("__cid__")?a.__cid__:""}}(),Fire.log=function(){console.log.apply(console,arguments)},Fire.info=function(){(console.info||console.log).apply(console,arguments)},Fire.warn=function(){console.warn.apply(console,arguments)},Fire.error=console.error.bind?console.error.bind(console):function(){console.error.apply(console,arguments)},function(){var a=Math.PI/180,b=180/Math.PI;JS.mixin(Math,{TWO_PI:2*Math.PI,HALF_PI:.5*Math.PI,deg2rad:function(b){return b*a},rad2deg:function(a){return a*b},rad180:function(a){return(a>Math.PI||a<-Math.PI)&&(a=(a+Math.TOW_PI)%Math.TOW_PI),a},rad360:function(a){return a>Math.TWO_PI?a%Math.TOW_PI:0>a?Math.TOW_PI+a%Math.TOW_PI:a},deg180:function(a){return(a>180||-180>a)&&(a=(a+360)%360),a},deg360:function(a){return a>360?a%360:0>a?360+a%360:a},randomRange:function(a,b){return Math.random()*(b-a)+a},randomRangeInt:function(a,b){return Math.floor(this.randomRange(a,b))},clamp:function(a,b,c){return b="undefined"==typeof b?0:b,c="undefined"==typeof c?1:c,Math.min(Math.max(a,b),c)},calculateMaxRect:function(a,b,c,d,e){var f=Math.min(b.x,c.x,d.x,e.x),g=Math.max(b.x,c.x,d.x,e.x),h=Math.min(b.y,c.y,d.y,e.y),i=Math.max(b.y,c.y,d.y,e.y);return a.x=f,a.y=h,a.width=g-f,a.height=i-h,a}})}(),Fire.Intersection=function(){function a(a,b,c,d){var e=(d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x),f=(b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x),g=(d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y);if(0!==g){var h=e/g,i=f/g;if(h>=0&&1>=h&&i>=0&&1>=i)return!0}return!1}function b(b,c,d){var e=new Fire.Vec2(d.x,d.y),f=new Fire.Vec2(d.x,d.yMax),g=new Fire.Vec2(d.xMax,d.yMax),h=new Fire.Vec2(d.xMax,d.y);return a(b,c,e,f)?!0:a(b,c,f,g)?!0:a(b,c,g,h)?!0:a(b,c,h,e)?!0:!1}function c(b,c,d){for(var e=d.points.length,f=0;e>f;++f){var g=d.points[f],h=d.points[(f+1)%e];if(a(b,c,g,h))return!0}return!1}function d(a,b){var c=a.x,d=a.y,e=a.x+a.width,f=a.y+a.height,g=b.x,h=b.y,i=b.x+b.width,j=b.y+b.height;return i>=c&&e>=g&&j>=d&&f>=h}function e(a,b){var d,e=new Fire.Vec2(a.x,a.y),f=new Fire.Vec2(a.x,a.yMax),g=new Fire.Vec2(a.xMax,a.yMax),h=new Fire.Vec2(a.xMax,a.y);if(c(e,f,b))return!0;if(c(f,g,b))return!0;if(c(g,h,b))return!0;if(c(h,e,b))return!0;for(d=0;d<b.points.length;++d)if(a.contains(b.points[d]))return!0;return b.contains(e)?!0:b.contains(f)?!0:b.contains(g)?!0:b.contains(h)?!0:!1}function f(a,b){var d;for(d=0;d<length;++d){var e=a.points[d],f=a.points[(d+1)%length];if(c(e,f,b))return!0}for(d=0;d<b.points.length;++d)if(a.contains(b.points[d]))return!0;for(d=0;d<a.points.length;++d)if(b.contains(a.points[d]))return!0;return!1}var g={};return g.lineLine=a,g.lineRect=b,g.linePolygon=c,g.rectRect=d,g.rectPolygon=e,g.polygonPolygon=f,g}(),function(){var a=function(){this._callbackTable={}};Fire._CallbacksHandler=a,a.prototype.add=function(a,b){var c=this._callbackTable[a];return"undefined"!=typeof c?(b&&(null!==c?c.push(b):(c=[b],this._callbackTable[a]=c)),!1):(c=b?[b]:null,this._callbackTable[a]=c,!0)},a.prototype.has=function(a,b){var c=this._callbackTable[a];return c&&c.length>0?b?-1!==c.indexOf(b):!0:!1},a.prototype.removeAll=function(a){delete this._callbackTable[a]},a.prototype.remove=function(a,b){var c=this._callbackTable[a];if(c){var d=c.indexOf(b);if(-1!==d)return c.splice(d,1),!0}return!1};var b=function(){this._callbackTable={}};return JS.extend(b,a),Fire.CallbacksInvoker=b,b.prototype.invoke=function(a,b,c,d,e,f){var g=this._callbackTable[a];if(g)for(var h=0;h<g.length;h++)g[h](b,c,d,e,f)},b.prototype.invokeAndRemove=function(a,b,c,d,e,f){var g=this._callbackTable[a];if(g)for(var h=0;h<g.length;h++)g[h](b,c,d,e,f);this.removeAll(a)},b.prototype.bindKey=function(a,b){var c=this;return function(d,e,f,g,h){var i=c._callbackTable[a];if(i)for(var j=0;j<i.length;j++)i[j](d,e,f,g,h);b&&c.removeAll(a)}},b}(),Fire.padLeft=function(a,b,c){return a=a.toString(),b-=a.length,b>0?new Array(b+1).join(c)+a:a},Fire.getEnumList=function(a){if(void 0!==a.__enums__)return a.__enums__;var b=[];for(var c in a)if(a.hasOwnProperty(c)){var d=parseInt(c);isNaN(d)&&b.push({name:a[a[c]],value:a[c]})}return b.sort(function(a,b){return a.value-b.value}),a.__enums__=b,a.__enums__},Fire.getVarFrom=function(a,b){for(var c=b.split("."),d=a,e=0;e<c.length;++e){var f=c[e];if(d=d[f],void 0===d||null===d)return null}return d},Fire.rgb2hsv=function(a,b,c){var d={h:0,s:0,v:0},e=Math.max(a,b,c),f=Math.min(a,b,c),g=0;return d.v=e,d.s=e?(e-f)/e:0,d.s?(g=e-f,d.h=a===e?(b-c)/g:b===e?2+(c-a)/g:4+(a-b)/g,d.h/=6,d.h<0&&(d.h+=1)):d.h=0,d},Fire.hsv2rgb=function(a,b,c){var d={r:0,g:0,b:0};if(0===b)d.r=d.g=d.b=c;else if(0===c)d.r=d.g=d.b=0;else{1===a&&(a=0),a*=6,b=b,c=c;var e=Math.floor(a),f=a-e,g=c*(1-b),h=c*(1-b*f),i=c*(1-b*(1-f));switch(e){case 0:d.r=c,d.g=i,d.b=g;break;case 1:d.r=h,d.g=c,d.b=g;break;case 2:d.r=g,d.g=c,d.b=i;break;case 3:d.r=g,d.g=h,d.b=c;break;case 4:d.r=i,d.g=g,d.b=c;break;case 5:d.r=c,d.g=g,d.b=h}}return d},Fire.attr=function(a,b,c){var d,e,f,g="_attr$"+b;if("function"==typeof a){if(d=a.prototype,e=d[g],"undefined"!=typeof c){if("object"!=typeof c)return d[g]=c,c;e||(d[g]=e={});for(f in c)"_"!==f[0]&&(e[f]=c[f])}return e}if(d=a,"undefined"!=typeof c){if("object"==typeof c){d.hasOwnProperty(g)&&(e=d[g]),e||(d[g]=e={});for(f in c)"_"!==f[0]&&(e[f]=c[f]);return JS.addon({},e,d.constructor.prototype[g])}return d[g]=c,c}return e=d[g],"object"==typeof e?JS.addon({},e,d.constructor.prototype[g]):e},Fire.NonSerialized={serializable:!1,_canUsedInGetter:!1},Fire.EditorOnly={editorOnly:!0,_canUsedInGetter:!1},Fire.Integer={type:"int"},Fire.Float={type:"float"},Fire.SingleText={textMode:"single"},Fire.MultiText={textMode:"multi"},Fire.Boolean={type:"boolean"},Fire.String={type:"string"},Fire.ObjectType=function(a){return{type:"object",ctor:a}},Fire.Enum=function(a){return{type:"enum",enumList:Fire.getEnumList(a)}},Fire.EnumList=function(a){return{type:"enum",enumList:a}},Fire.RawType=function(a){var b=["image","json","text","audio"];return{type:"raw",rawType:a,serializable:!1,hideInInspector:!0,_canUsedInGetter:!1,_onAfterProp:function(a,c){var d=Fire.attr(a,c)||{},e=-1!==b.indexOf(d.rawType);e&&a.prop("_rawext","",Fire.HideInInspector)}}},Fire.Custom=function(a){return{custom:a}},Fire.HideInInspector={hideInInspector:!0},Fire.DisplayName=function(a){return{displayName:a}},Fire.ReadOnly={readOnly:!0},Fire.Tooltip=function(a){return{tooltip:a}},Fire.Nullable=function(a,b){return{nullable:a,_onAfterProp:function(c,d){c.prop(a,b,Fire.HideInInspector);var e=Fire.attr(c,d)||{};e.serializable===!1?Fire.attr(c,a,Fire.NonSerialized):e.editorOnly&&Fire.attr(c,a,Fire.EditorOnly)}}},Fire.Watch=function(a,b){return{watch:[].concat(a),watchCallback:b}},Fire.Range=function(a,b){return{min:a,max:b}};var _appendProp=function(a){if(this.__props__){var b=this.__props__.indexOf(a);0>b&&this.__props__.push(a)}else this.__props__=[a]},_metaClass={__props__:null,prop:function(a,b,c){"use strict";if(Fire.attr(this,a,{"default":b}),_appendProp.call(this,a),c){for(var d=null,e=2,f=e;f<arguments.length;f++){var g=arguments[f];Fire.attr(this,a,g),g._onAfterProp&&(d=d||[],d.push(g._onAfterProp))}if(d)for(var h=0;h<d.length;h++)d[h](this,a)}return this},get:function(a,b,c){"use strict";if(c)for(var d=2,e=d;e<arguments.length;e++){var f=arguments[e];Fire.attr(this,a,f)}return Fire.attr(this,a,Fire.NonSerialized),Object.defineProperty(this.prototype,a,{get:b,configurable:!0}),this},set:function(a,b){return Object.defineProperty(this.prototype,a,{set:b,configurable:!0}),this},getset:function(a,b,c,d){return this.get(a,b,d),this.set(a,c),this}},_createInstanceProps=function(a,b){var c=b.__props__;if(c)for(var d=0;d<c.length;d++){var e=c[d],f=Fire.attr(b,e);if(f&&f.hasOwnProperty("default")){var g=f["default"];"object"==typeof g&&g&&(g=g.clone?g.clone():Array.isArray(g)?[]:{}),a[e]=g}}};Fire._isFireClass=function(a){return!!a&&a.prop===_metaClass.prop},Fire.isChildClassOf=function(a,b){if(a&&b){if("function"!=typeof a)return!1;if("function"!=typeof b)return!1;for(;a&&a.$super;a=a.$super)if(a===b)return!0;if(a===b)return!0;for(var c=Object.getPrototypeOf(a.prototype);c;){if(a=c.constructor,a===b)return!0;c=Object.getPrototypeOf(a.prototype)}}return!1},Fire.define=function(a,b){return _defineFireClass(a,null,b)},Fire.extend=function(a,b,c){return _defineFireClass(a,b,c)},Fire._fastDefine=function(a,b,c){JS.setClassName(a,b),b.__props__=c;for(var d=0;d<c.length;d++)Fire.attr(b,c[d],Fire.HideInInspector)},Fire.Path=Fire.isNode?require("path"):function(){var a;if(Fire.isWin32){var b=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,c=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/;a=function(a){var d=b.exec(a),e=(d[1]||"")+(d[2]||""),f=d[3]||"",g=c.exec(f),h=g[1],i=g[2],j=g[3];return[e,h,i,j]}}else{var d=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;a=function(a){return d.exec(a).slice(1)}}return path={basename:function(a){return a.replace(/^.*(\\|\/|\:)/,"")},extname:function(a){return a.substring((~-a.lastIndexOf(".")>>>0)+1)},dirname:function(b){var c=a(b),d=c[0],e=c[1];return d||e?(e&&(e=e.substr(0,e.length-1)),d+e):"."},sep:Fire.isWin32?"\\":"/"},path}(),Fire.Path.setExtname=function(a,b){var c=(~-a.lastIndexOf(".")>>>0)+1;return a.substring(0,c)+b},Fire.Path.setEndWithSep=function(a,b){b="undefined"!=typeof b?b:!0;var c=a[a.length-1],d="\\"===c||"/"===c;return!d&&b?a+=Fire.Path.sep:d&&!b&&(a=a.substring(0,a.length-1)),a},FObject=function(){function a(){this._name="",this._objFlags=0}Fire._fastDefine("Fire.FObject",a,["_name","_objFlags"]),Fire.isValid=function(a){return!(!a||a._objFlags&Destroyed)},Object.defineProperty(a,"isValid",{value:function(a){return Fire.warn("FObject.isValid is deprecated, use Fire.isValid instead please"),Fire.isValid(a)},enumerable:!1});var b=[];return Object.defineProperty(a,"_deferredDestroy",{value:function(){for(var a=b.length,c=0;a>c;++c){var d=b[c];d._objFlags&Destroyed||d._destroyImmediate()}a===b.length?b.length=0:b.splice(0,a)},enumerable:!1}),Object.defineProperty(a.prototype,"name",{get:function(){return this._name},set:function(a){this._name=a},enumerable:!1}),Object.defineProperty(a.prototype,"isValid",{get:function(){return!(this._objFlags&Destroyed)}}),a.prototype.destroy=function(){return this._objFlags&Destroyed?void Fire.error("object already destroyed"):this._objFlags&ToDestroy?!1:(this._objFlags|=ToDestroy,b.push(this),!0)},a.prototype._destruct=function(){for(var a in this)if(this.hasOwnProperty(a)){var b=typeof this[a];switch(b){case"string":this[a]="";break;case"object":this[a]=null;break;case"function":this[a]=null}}},a.prototype._destroyImmediate=function(){return this._objFlags&Destroyed?void Fire.error("object already destroyed"):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),void(this._objFlags|=Destroyed))},a}(),Fire.FObject=FObject;var HashObject=function(){var a=Fire.extend("Fire.HashObject",Fire.FObject,function(){Object.defineProperty(this,"_hashCode",{value:0,writable:!0,enumerable:!1}),Object.defineProperty(this,"_id",{value:"",writable:!0,enumerable:!1})}),b=0;return Object.defineProperty(a.prototype,"hashCode",{get:function(){return this._hashCode||(this._hashCode=++b)}}),Object.defineProperty(a.prototype,"id",{get:function(){return this._id||(this._id=""+this.hashCode)}}),a}();Fire.HashObject=HashObject,Vec2=function(){function a(a,b){this.x="number"==typeof a?a:0,this.y="number"==typeof b?b:0}return JS.setClassName("Fire.Vec2",a),Object.defineProperty(a,"one",{get:function(){return new a(1,1)}}),Object.defineProperty(a,"zero",{get:function(){return new a(0,0)}}),a.prototype.clone=function(){return new a(this.x,this.y)},a.prototype.set=function(a){this.x=a.x,this.y=a.y},a.prototype.equals=function(a){return a&&a.constructor===Fire.Vec2?this.x===a.x&&this.y===a.y:!1},a.prototype.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},a.prototype.addSelf=function(a){return this.x+=a.x,this.y+=a.y,this},a.prototype.add=function(b,c){return c=c||new a,c.x=this.x+b.x,c.y=this.y+b.y,c},a.prototype.subSelf=function(a){return this.x-=a.x,this.y-=a.y,this},a.prototype.sub=function(b,c){return c=c||new a,c.x=this.x-b.x,c.y=this.y-b.y,c},a.prototype.mulSelf=function(a){return this.x*=a,this.y*=a,this},a.prototype.mul=function(b,c){return c=c||new a,c.x=this.x*b,c.y=this.y*b,c},a.prototype.scaleSelf=function(a){return this.x*=a.x,this.y*=a.y,this},a.prototype.scale=function(b,c){return c=c||new a,c.x=this.x*b.x,c.y=this.y*b.y,c},a.prototype.divSelf=function(a){return this.x/=a.x,this.y/=a.y,this},a.prototype.div=function(b,c){return c=c||new a,c.x=this.x/b.x,c.y=this.y/b.y,c},a.prototype.negSelf=function(){return this.x=-this.x,this.y=-this.y,this},a.prototype.neg=function(b){return b=b||new a,b.x=-this.x,b.y=-this.y,b},a.prototype.dot=function(a){return this.x*a.x+this.y*a.y},a.prototype.cross=function(a){return this.y*a.x-this.x*a.y},a.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},a.prototype.magSqr=function(){return this.x*this.x+this.y*this.y},a.prototype.normalizeSelf=function(){var a=this.x*this.x+this.y*this.y;if(1===a)return this;if(0===a)return console.warn("Can't normalize zero vector"),this;var b=1/Math.sqrt(a);return this.x*=b,this.y*=b,this},a.prototype.normalize=function(b){return b=b||new a,b.x=this.x,b.y=this.y,b.normalizeSelf(),b},a.prototype.angle=function(a){var b=this.magSqr(),c=a.magSqr();if(0===b||0===c)return console.warn("Can't get angle between zero vector"),0;var d=this.dot(a),e=d/Math.sqrt(b*c);return e=Math.clamp(e,-1,1),Math.acos(e)},a.prototype.signAngle=function(a){return Math.atan2(this.y,this.x)-Math.atan2(a.y,a.x)},a.prototype.rotate=function(b,c){return c=c||new a,c.x=this.x,c.y=this.y,c.rotateSelf(b)},a.prototype.rotateSelf=function(a){var b=Math.sin(a),c=Math.cos(a),d=this.x;return this.x=c*d-b*this.y,this.y=b*d+c*this.y,this},a}(),Fire.Vec2=Vec2,Fire.v2=function(a,b){return Array.isArray(a)?new Vec2(a[0],a[1]):new Vec2(a,b)};var Matrix23=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0};JS.setClassName("Fire.Matrix23",Matrix23),Fire.Matrix23=Matrix23,Matrix23.identity=new Matrix23,Matrix23.prototype.clone=function(){var a=new Matrix23;return a.a=this.a,a.b=this.b,a.c=this.c,a.d=this.d,a.tx=this.tx,a.ty=this.ty,a},Matrix23.prototype.set=function(a){this.a=a.a,this.b=a.b,this.c=a.c,this.d=a.d,this.tx=a.tx,this.ty=a.ty},Matrix23.prototype.equals=function(a){return this.a===a.a&&this.b===a.b&&this.c===a.c&&this.d===a.d&&this.tx===a.tx&&this.ty===a.ty},Matrix23.prototype.toString=function(){return"|"+this.a.toFixed(2)+" "+this.c.toFixed(2)+" "+this.tx.toFixed(2)+"|\n|"+this.b.toFixed(2)+" "+this.d.toFixed(2)+" "+this.ty.toFixed(2)+"|\n|0.00 0.00 1.00|"},Matrix23.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},Matrix23.prototype.prepend=function(a){var b=a.a,c=a.b,d=a.c,e=a.d;if(1!==b||0!==c||0!==d||1!==e){var f=this.a,g=this.c;this.a=f*b+this.b*d,this.b=f*c+this.b*e,this.c=g*b+this.d*d,this.d=g*c+this.d*e;var h=this.tx;this.tx=h*b+this.ty*d+a.tx,this.ty=h*c+this.ty*e+a.ty}else this.tx+=a.tx,this.ty+=a.ty;return this},Matrix23.prototype.invert=function(){var a=this.a,b=this.b,c=this.c,d=this.d,e=this.tx,f=1/(a*d-b*c);return this.a=d*f,this.b=-b*f,this.c=-c*f,this.d=a*f,this.tx=(c*this.ty-d*e)*f,this.ty=(b*e-a*this.ty)*f,this},Matrix23.prototype.transformPoint=function(a,b){b=b||new Vec2;var c=a.x;return b.x=this.a*c+this.c*a.y+this.tx,b.y=this.b*c+this.d*a.y+this.ty,b},Matrix23.prototype.getScale=function(a){return a=a||new Vec2,a.x=Math.sqrt(this.a*this.a+this.b*this.b),a.y=Math.sqrt(this.c*this.c+this.d*this.d),a},Matrix23.prototype.setScale=function(a){var b=this.getScale(),c=a.x/b.x,d=a.y/b.y;return this.a*=c,this.b*=c,this.c*=d,this.d*=d,this},Matrix23.prototype.getRotation=function(){var a=this.b/this.a!==-this.c/this.d;return a?.5*(Math.atan2(this.b,this.a)+Math.atan2(-this.c,this.d)):Math.atan2(-this.c,this.d)},Matrix23.prototype.getTranslation=function(a){return a=a||new Vec2,a.x=this.tx,a.y=this.ty,a},Matrix23.prototype.rotate=function(a){var b=Math.sin(a),c=Math.cos(a),d=this.a,e=this.b;return this.a=d*c+this.c*b,this.b=e*c+this.d*b,this.c=this.c*c-d*b,this.d=this.d*c-e*b,this};var Rect=function(){function a(a,b,c,d){this.x="number"==typeof a?a:0,this.y="number"==typeof b?b:0,this.width="number"==typeof c?c:0,this.height="number"==typeof d?d:0}return JS.setClassName("Fire.Rect",a),a.fromVec2=function(b,c){var d=Math.min(b.x,c.x),e=Math.min(b.y,c.y),f=Math.max(b.x,c.x),g=Math.max(b.y,c.y);return new a(d,e,f-d,g-e)},a.contain=function(a,b){return a.x<=b.x&&a.x+a.width>=b.x+b.width&&a.y<=b.y&&a.y+a.height>=b.y+b.height?1:b.x<=a.x&&b.x+b.width>=a.x+a.width&&b.y<=a.y&&b.y+b.height>=a.y+a.height?-1:0},a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height)},a.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height},a.prototype.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},Object.defineProperty(a.prototype,"xMax",{get:function(){return this.x+this.width}}),Object.defineProperty(a.prototype,"yMax",{get:function(){return this.y+this.height}}),Object.defineProperty(a.prototype,"center",{get:function(){return new Fire.Vec2(this.x+.5*this.width,this.y+.5*this.height)}}),a.prototype.intersects=function(a){return Fire.Intersection.rectRect(this,a)},a.prototype.contains=function(a){return this.x<=a.x&&this.x+this.width>=a.x&&this.y<=a.y&&this.y+this.height>=a.y?!0:!1},a.prototype.containsRect=function(a){return this.x<=a.x&&this.x+this.width>=a.x+a.width&&this.y<=a.y&&this.y+this.height>=a.y+a.height?!0:!1},a}();Fire.Rect=Rect,Fire.rect=function(a,b,c,d){return Array.isArray(a)?new Rect(a[0],a[1],a[2],a[3]):new Rect(a,b,c,d)},Fire.Polygon=function(){function a(a){this.points=a,this.points.length<3&&console.warn("Invalid polygon, the data must contains 3 or more points.")}return JS.setClassName("Fire.Polygon",a),a.prototype.intersects=function(a){return Intersection.polygonPolygon(this,a)},a.prototype.contains=function(a){for(var b=!1,c=a.x,d=a.y,e=this.points.length,f=0,g=e-1;e>f;g=f++){var h=this.points[f].x,i=this.points[f].y,j=this.points[g].x,k=this.points[g].y,l=i>d!=k>d&&(j-h)*(d-i)/(k-i)+h>c;l&&(b=!b)}return b},Object.defineProperty(a.prototype,"center",{get:function(){if(this.points.length<3)return null;for(var a=this.points[0].x,b=this.points[0].y,c=this.points[0].x,d=this.points[0].y,e=1;e<this.points.length;++e){var f=this.points[e].x,g=this.points[e].y;a>f?a=f:f>c&&(c=f),b>g?b=g:g>d&&(d=g)}return new Fire.Vec2(.5*(c+a),.5*(d+b))}}),a}();var Color=function(){function a(a,b,c,d){this.r="number"==typeof a?a:0,this.g="number"==typeof b?b:0,this.b="number"==typeof c?c:0,this.a="number"==typeof d?d:1}return JS.setClassName("Fire.Color",a),a.prototype.clone=function(){return new a(this.r,this.g,this.b,this.a)},a.prototype.equals=function(a){return this.r===a.r&&this.g===a.g&&this.b===a.b&&this.a===a.a},a.prototype.toString=function(){return"rgba("+this.r.toFixed(2)+", "+this.g.toFixed(2)+", "+this.b.toFixed(2)+", "+this.a.toFixed(2)+")"},a.prototype.toCSS=function(a){return"rgba"===a?"rgba("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+","+this.a.toFixed(2)+")":"rgb"===a?"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")":"#"+this.toHEX(a)},a.prototype.equalTo=function(b){return b instanceof a&&this.r===b.r&&this.g===b.g&&this.b===b.b&&this.a===b.a},a.prototype.clamp=function(){this.r=Math.clamp(this.r),this.g=Math.clamp(this.g),this.b=Math.clamp(this.b),this.a=Math.clamp(this.a)},a.prototype.fromHEX=function(a){var b=parseInt(a.indexOf("#")>-1?a.substring(1):a,16);return this.r=b>>16,this.g=(65280&b)>>8,this.b=255&b,this},a.prototype.toHEX=function(a){var b=[(255*this.r|0).toString(16),(255*this.g|0).toString(16),(255*this.b|0).toString(16)],c=-1;if("#rgb"===a)for(c=0;c<b.length;++c)b[c].length>1&&(b[c]=b[c][0]);else if("#rrggbb"===a)for(c=0;c<b.length;++c)1===b[c].length&&(b[c]="0"+b[c]);return b.join("")},a.prototype.toRGBValue=function(){return(255*this.r<<16)+(255*this.g<<8)+255*this.b},a.prototype.fromHSV=function(a,b,c){var d=Fire.hsv2rgb(a,b,c);return this.r=d.r,this.g=d.g,this.b=d.b,this},a.prototype.toHSV=function(){return Fire.rgb2hsv(this.r,this.g,this.b)},a}();Fire.Color=Color,Fire.color=function(a,b,c,d){return Array.isArray(a)?new Color(a[0],a[1],a[2],a[3]):new Color(a,b,c,d)};var _Deserializer=function(){function a(a,b,c,f,g){if(this._editor=f,this._classFinder=g,this._idList=[],this._idObjList=[],this._idPropList=[],this.result=b||new Fire._DeserializeInfo,Array.isArray(a)){var h=a,i=h.length;this.deserializedList=new Array(i);for(var j=0;i>j;j++)if(h[j]){var k;this.deserializedList[j]=e(this,h[j],k)}this.deserializedData=i>0?this.deserializedList[0]:[]}else this.deserializedList=[null],this.deserializedData=a?e(this,a,c):null,this.deserializedList[0]=this.deserializedData;d(this)}function b(a,b,c,d){var f=c.__id__;if("undefined"==typeof f){var g=c.__uuid__;g?(a.result.uuidList.push(g),a.result.uuidObjList.push(b),a.result.uuidPropList.push(d)):b[d]=e(a,c)}else{var h=a.deserializedList[f];h?b[d]=h:(a._idList.push(f),a._idObjList.push(b),a._idPropList.push(d))}}function c(a,c,d){for(var f in c){var g=d[f];"undefined"!=typeof g&&d.hasOwnProperty(f)&&("object"!=typeof g?c[f]=g:g?g.__uuid__||"undefined"!=typeof g.__id__?b(a,c,g,f):c[f]=e(a,g):c[f]=null)}}var d=function(a){for(var b=a.deserializedList,c=0,d=a._idList.length;d>c;c++){var e=a._idPropList[c],f=a._idList[c];a._idObjList[c][e]=b[f]}},e=function(a,d){var f,g,h=null,i=null;if(d.__type__){if(i=a._classFinder(d.__type__),!i)return Fire.error("[Fire.deserialize] unknown type: "+d.__type__),null;h=new i}else{if(Array.isArray(d)){h=d;for(var j=0;j<d.length;j++)g=d[j],"object"==typeof g&&g&&(g.__uuid__||"undefined"!=typeof g.__id__?b(a,h,g,""+j):h[j]=e(a,g));return h}h=d}if(i&&Fire._isFireClass(i)){var k=i.__props__;if(!k)return h;for(var l=0;l<k.length;l++){f=k[l];var m=Fire.attr(i,f),n=m.rawType;if(n)a.result.rawProp&&Fire.error("not support multi raw object in a file"),a.result.rawProp=f;else{if(m.serializable===!1)continue;if(!a._editor&&m.editorOnly)continue;g=d[f],"undefined"!=typeof g&&("object"!=typeof g?h[f]=g:g?g.__uuid__||"undefined"!=typeof g.__id__?b(a,h,g,f):h[f]=e(a,g):h[f]=null)}}"_$erialized"===k[k.length-1]&&(h._$erialized=d,c(a,h._$erialized,d))}else c(a,h,d);return h};return a}();Fire.deserialize=function(a,b,c){var d,e=c&&"isEditor"in c?c.isEditor:Fire.isEditor,f=c&&c.classFinder||JS._getClassById,g=c&&c.createAssetRefs||Fire.isEditorCore;"string"==typeof a&&(a=JSON.parse(a)),g&&!b&&(b=new Fire._DeserializeInfo),Fire._isCloning=!0;var h=new _Deserializer(a,b,d,e,f);return Fire._isCloning=!1,g&&b.assignAssetsBy(Fire.serialize.asAsset),h.deserializedData},Fire._DeserializeInfo=function(){this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.rawProp=""},Fire._DeserializeInfo.prototype.reset=function(){this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.rawProp=""},Fire._DeserializeInfo.prototype.getUuidOf=function(a,b){for(var c=0;c<this.uuidObjList.length;c++)if(this.uuidObjList[c]===a&&this.uuidPropList[c]===b)return this.uuidList[c];return""},Fire._DeserializeInfo.prototype.assignAssetsBy=function(a){for(var b=0,c=this.uuidList.length;c>b;b++){var d=this.uuidList[b],e=a(d);if(e){var f=this.uuidObjList[b],g=this.uuidPropList[b];f[g]=e}else Fire.error("Failed to assign asset: "+d)}},Fire.instantiate=function(a){if("object"!=typeof a||Array.isArray(a))return Fire.error("The thing you want to instantiate must be an object"),null;if(!a)return Fire.error("The thing you want to instantiate is nil"),null;if(a instanceof Fire.FObject&&!a.isValid)return Fire.error("The thing you want to instantiate is destroyed"),null;var b;return a._instantiate?(Fire._isCloning=!0,b=a._instantiate(),Fire._isCloning=!1,b):a instanceof Fire.Asset?(Fire.error("The instantiate method for given asset do not implemented"),null):(Fire._isCloning=!0,b=Fire._doInstantiate(a),Fire._isCloning=!1,b)},Fire._doInstantiate=function(){function a(a){if(Array.isArray(a))return Fire.error("Can not instantiate array"),null;if(_isDomNode(a))return Fire.error("Can not instantiate DOM element"),null;for(var b=d(a),e=0,f=c.length;f>e;++e)c[e]._iN$t=null;return c.length=0,b}function b(a){var e=a._iN$t;if(e)return e;if(a instanceof Asset)return a;if(Array.isArray(a)){var f=a.length;e=new Array(f),a._iN$t=e;for(var g=0;f>g;++g){var h=a[g],i=typeof h;e[g]="object"===i?h?b(h):h:"function"!==i?h:null}return c.push(a),e}return _isDomNode(a)?null:d(a)
}var c=[],d=function(a){var d,e,f=a.constructor,g=new f;if(a._iN$t=g,c.push(a),Fire._isFireClass(f)){var h=f.__props__;if(h)for(var i=0;i<h.length;i++){var j=h[i],k=Fire.attr(f,j);k.serializable!==!1&&(d=a[j],e=typeof d,g[j]="object"===e?d?b(d):d:"function"!==e?d:null)}}else for(var l in a)a.hasOwnProperty(l)===!1||95===l.charCodeAt(0)&&95===l.charCodeAt(1)||(d=a[l],d!==g&&(e=typeof d,g[l]="object"===e?d?b(d):d:"function"!==e?d:null));return a instanceof FObject&&(g._objFlags&=PersistentMask),g};return a}(),Fire._isCloning=!1;var Asset=function(){var a=Fire.extend("Fire.Asset",Fire.HashObject,function(){Object.defineProperty(this,"_uuid",{value:"",writable:!0,enumerable:!1})});return a.prototype._setRawExtname=function(a){this.hasOwnProperty("_rawext")?("."===a.charAt(0)&&(a=a.substring(1)),this._rawext=a):Fire.error("Have not defined any RawTypes yet, no need to set raw file's extname.")},a}();Fire.Asset=Asset;var CustomAsset=function(){var a=Fire.extend("Fire.CustomAsset",Fire.Asset);return a}();Fire.CustomAsset=CustomAsset,Fire.addCustomAssetMenu=Fire.addCustomAssetMenu||function(){},Fire.Texture=function(){var a=Fire.extend("Fire.Texture",Fire.Asset,function(){var a=arguments[0];a&&(this.image=a,this.width=a.width,this.height=a.height)});return a.WrapMode=function(a){return a[a.Repeat=0]="Repeat",a[a.Clamp=1]="Clamp",a}({}),a.FilterMode=function(a){return a[a.Point=0]="Point",a[a.Bilinear=1]="Bilinear",a[a.Trilinear=2]="Trilinear",a}({}),a.prop("image",null,Fire.RawType("image")),a.prop("width",0,Fire.Integer),a.prop("height",0,Fire.Integer),a.prop("wrapMode",a.WrapMode.Clamp,Fire.Enum(a.WrapMode)),a.prop("filterMode",a.FilterMode.Bilinear,Fire.Enum(a.FilterMode)),a}(),Fire.Sprite=function(){var a=Fire.extend("Fire.Sprite",Fire.Asset,function(){var a=arguments[0];a&&(this.texture=new Fire.Texture(a),this.width=a.width,this.height=a.height)});return a.prop("pivot",new Fire.Vec2(.5,.5),Fire.Tooltip("The pivot is normalized, like a percentage.\n(0,0) means the bottom-left corner and (1,1) means the top-right corner.\nBut you can use values higher than (1,1) and lower than (0,0) too.")),a.prop("trimX",0,Fire.Integer),a.prop("trimY",0,Fire.Integer),a.prop("width",0,Fire.Integer),a.prop("height",0,Fire.Integer),a.prop("texture",null,Fire.ObjectType(Fire.Texture),Fire.HideInInspector),a.prop("rotated",!1,Fire.HideInInspector),a.prop("x",0,Fire.Integer,Fire.HideInInspector),a.prop("y",0,Fire.Integer,Fire.HideInInspector),a.prop("rawWidth",0,Fire.Integer,Fire.HideInInspector),a.prop("rawHeight",0,Fire.Integer,Fire.HideInInspector),Object.defineProperty(a.prototype,"rotatedWidth",{get:function(){return this.rotated?this.height:this.width}}),Object.defineProperty(a.prototype,"rotatedHeight",{get:function(){return this.rotated?this.width:this.height}}),a}(),Fire.Atlas=function(){var a=Fire.extend("Fire.Atlas",Fire.Asset);return a.Algorithm=function(a){return a[a.Basic=0]="Basic",a[a.Tree=1]="Tree",a[a.MaxRect=2]="MaxRect",a}({}),a.SortBy=function(a){return a[a.UseBest=0]="UseBest",a[a.Width=1]="Width",a[a.Height=2]="Height",a[a.Area=3]="Area",a[a.Name=4]="Name",a}({}),a.SortOrder=function(a){return a[a.UseBest=0]="UseBest",a[a.Ascending=1]="Ascending",a[a.Descending=2]="Descending",a}({}),a.prop("width",512,Fire.Integer),a.prop("height",512,Fire.Integer),a.prop("sprites",[],Fire.ObjectType(Fire.Sprite),Fire.HideInInspector),a.prototype.add=function(a){for(var b=0;b<this.sprites.length;++b){var c=this.sprites[b];if(c._uuid===a._uuid)return!1}return this.sprites.push(a),!0},a.prototype.remove=function(a){for(var b=0;b<this.sprites.length;++b){var c=this.sprites[b];if(c._uuid===a._uuid)return this.sprites.splice(b,1),!0}return!1},a.prototype.clear=function(){this.sprites=[]},a.prototype.layout=function(a){void 0===a.algorithm&&(a.algorithm=Fire.Atlas.Algorithm.MaxRect),void 0===a.sortBy&&(a.sortBy=Fire.Atlas.SortBy.UseBest),void 0===a.sortOrder&&(a.sortOrder=Fire.Atlas.SortOrder.UseBest),void 0===a.allowRotate&&(a.allowRotate=!0),void 0===a.autoSize&&(a.autoSize=!0),void 0===a.padding&&(a.padding=2),Fire.AtlasUtils.sort(this,a.algorithm,a.sortBy,a.sortOrder,a.allowRotate),Fire.AtlasUtils.layout(this,a.algorithm,a.autoSize,a.padding,a.allowRotate)},a}();var AtlasUtils={},_basicLayout=function(a,b){for(var c=0,d=0,e=0,f=0;f<a.sprites.length;++f){var g=a.sprites[f];if(c+g.rotatedWidth>a.width&&(c=0,d=d+e+b,e=0),d+g.rotatedHeight>a.height)throw new Error("Warning: Failed to layout element "+g.name);g.x=c,g.y=d,c=c+g.rotatedWidth+b,g.rotatedHeight>e&&(e=g.rotatedHeight)}},_insertNode=function(a,b,c,d){if(null!==a.right){var e=_insertNode(a.right,b,c,d);return null!==e?e:_insertNode(a.bottom,b,c,d)}var f=b.rotatedWidth,g=b.rotatedHeight,h=f+c,i=g+c,j=a.rect;if(f>j.width||g>j.height){if(d===!1)return null;if(g>j.width||f>j.height)return null;b.rotated=!b.rotated,f=b.rotatedWidth,g=b.rotatedHeight,h=f+c,i=g+c}return a.right={rect:new Fire.Rect(j.x+h,j.y,j.width-h,g),right:null,bottom:null},a.bottom={rect:new Fire.Rect(j.x,j.y+i,j.width,j.height-i),right:null,bottom:null},[j.x,j.y]},_treeLayout=function(a,b,c){for(var d={rect:new Fire.Rect(0,0,a.width,a.height),right:null,bottom:null},e=0;e<a.sprites.length;++e){var f=a.sprites[e],g=_insertNode(d,f,b,c);if(null===g)throw new Error("Warning: Failed to layout element "+f.name);f.x=g[0],f.y=g[1]}},_splitFreeNode=function(a,b,c){if(c.x>=b.x+b.width||c.x+c.width<=b.x||c.y>=b.y+b.height||c.y+c.height<=b.y)return!1;var d;return c.x<b.x+b.width&&c.x+c.width>b.x&&(c.y>b.y&&c.y<b.y+b.height&&(d=b.clone(),d.height=c.y-d.y,a.push(d)),c.y+c.height<b.y+b.height&&(d=b.clone(),d.y=c.y+c.height,d.height=b.y+b.height-(c.y+c.height),a.push(d))),c.y<b.y+b.height&&c.y+c.height>b.y&&(c.x>b.x&&c.x<b.x+b.width&&(d=b.clone(),d.width=c.x-d.x,a.push(d)),c.x+c.width<b.x+b.width&&(d=b.clone(),d.x=c.x+c.width,d.width=b.x+b.width-(c.x+c.width),a.push(d))),!0},_placeRect=function(a,b){var c;for(c=0;c<a.length;++c)_splitFreeNode(a,a[c],b)&&(a.splice(c,1),--c);for(c=0;c<a.length;++c)for(var d=c+1;d<a.length;++d){if(a[d].containsRect(a[c])){a.splice(c,1),--c;break}a[c].containsRect(a[d])&&(a.splice(d,1),--d)}},_maxRectLayout=function(a,b,c){var d=[];d.push(new Fire.Rect(0,0,a.width+b,a.height+b));for(var e,f=function(a,b,c,d){e=Number.MAX_VALUE,score2=Number.MAX_VALUE;for(var f=new Fire.Rect(0,0,1,1),g=!1,h=0;h<a.length;++h){var i,j,k,l,m=a[h];m.width>=b&&m.height>=c&&(i=Math.abs(Math.floor(m.width)-b),j=Math.abs(Math.floor(m.height)-c),k=Math.min(i,j),l=Math.max(i,j),(e>k||k===e&&l<score2)&&(f.x=m.x,f.y=m.y,f.width=b,f.height=c,e=k,score2=l,g=!0)),d&&m.width>=c&&m.height>=b&&(i=Math.abs(Math.floor(m.width)-c),j=Math.abs(Math.floor(m.height)-b),k=Math.min(i,j),l=Math.max(i,j),(e>k||k===e&&l<score2)&&(f.x=m.x,f.y=m.y,f.width=c,f.height=b,e=k,score2=l,g=!0))}return g===!1&&(e=Number.MAX_VALUE,score2=Number.MAX_VALUE),f},g=a.sprites.slice();g.length>0;){for(var h=Number.MAX_VALUE,i=Number.MAX_VALUE,j=-1,k=new Fire.Rect(0,0,1,1),l=0;l<g.length;++l){var m=f(d,g[l].width+b,g[l].height+b,c);(h>e||e===h&&score2<i)&&(h=e,i=score2,k=m,j=l)}if(-1===j)throw new Error("Error: Failed to layout atlas element");_placeRect(d,k);var n=g[j];n.x=Math.floor(k.x),n.y=Math.floor(k.y),n.rotated=n.width+b!==k.width,g.splice(j,1)}};AtlasUtils.layout=function(a,b,c,d,e){try{switch(b){case Fire.Atlas.Algorithm.Basic:_basicLayout(a,d);break;case Fire.Atlas.Algorithm.Tree:_treeLayout(a,d,e);break;case Fire.Atlas.Algorithm.MaxRect:_maxRectLayout(a,d,e)}}catch(f){if(c===!1)return void Fire.error(f.message);if(4096===a.width&&4096===a.height)return void Fire.error(f.message);a.width===a.height?a.width*=2:a.height=a.width,AtlasUtils.layout(a,b,c,d,e)}};var _compareByWidth=function(a,b){var c=a.width-b.width;return 0===c&&(c=a.name.localeCompare(b.name)),c},_compareByHeight=function(a,b){var c=a.height-b.height;return 0===c&&(c=a.name.localeCompare(b.name)),c},_compareByArea=function(a,b){var c=a.width*a.height-b.width*b.height;return 0===c&&(c=a.name.localeCompare(b.name)),c},_compareByName=function(a,b){return a.name.localeCompare(b.name)},_compareByRotateWidth=function(a,b){var c=a.width;a.height>a.width&&(c=a.height,a.rotated=!0);var d=b.width;b.height>b.width&&(d=b.height,b.rotated=!0);var e=c-d;return 0===e&&(e=a.name.localeCompare(b.name)),e},_compareByRotateHeight=function(a,b){var c=a.height;a.width>a.height&&(c=a.width,a.rotated=!0);var d=b.height;b.width>b.height&&(d=b.width,b.rotated=!0);var e=c-d;return 0===e&&(e=a.name.localeCompare(b.name)),e};AtlasUtils.sort=function(a,b,c,d,e){for(var f=0;f<a.sprites.length;++f){var g=a.sprites[f];g.rotated=!1}var h=c,i=d;if(h===Fire.Atlas.SortBy.UseBest)switch(b){case Fire.Atlas.Algorithm.Basic:h=Fire.Atlas.SortBy.Height;break;case Fire.Atlas.Algorithm.Tree:h=Fire.Atlas.SortBy.Area;break;case Fire.Atlas.Algorithm.MaxRect:h=Fire.Atlas.SortBy.Area;break;default:h=Fire.Atlas.SortBy.Height}switch(i===Fire.Atlas.SortOrder.UseBest&&(i=Fire.Atlas.SortOrder.Descending),h){case Fire.Atlas.SortBy.Width:a.sprites.sort(e?_compareByRotateWidth:_compareByWidth);break;case Fire.Atlas.SortBy.Height:a.sprites.sort(e?_compareByRotateHeight:_compareByHeight);break;case Fire.Atlas.SortBy.Area:a.sprites.sort(_compareByArea);break;case Fire.Atlas.SortBy.Name:a.sprites.sort(_compareByName)}i===Fire.Atlas.SortOrder.Descending&&a.sprites.reverse()},Fire.AtlasUtils=AtlasUtils;var JsonAsset=function(){var a=Fire.extend("Fire.JsonAsset",Asset).prop("json",null,Fire.RawType("json"));return a}();Fire.JsonAsset=JsonAsset,Fire.TextAsset=function(){var a=Fire.extend("Fire.TextAsset",Fire.Asset);return a.prop("text","",Fire.RawType("text")),a}();var BitmapFont=function(){var a=Fire.extend("Fire.BitmapFont",Fire.Asset);return a.prop("texture",null,Fire.ObjectType(Fire.Texture)),a.prop("charInfos",[]),a.prop("kernings",[]),a.prop("baseLine",0,Fire.Integer),a.prop("lineHeight",0,Fire.Integer),a.prop("size",0,Fire.Integer),a.prop("face",null,Fire.HideInInspector),a}();Fire.BitmapFont=BitmapFont;var Destroying=Fire._ObjectFlags.Destroying,Hide=Fire._ObjectFlags.Hide,HideInGame=Fire._ObjectFlags.HideInGame,HideInEditor=Fire._ObjectFlags.HideInEditor,IsOnEnableCalled=Fire._ObjectFlags.IsOnEnableCalled,IsOnLoadCalled=Fire._ObjectFlags.IsOnLoadCalled,IsOnStartCalled=Fire._ObjectFlags.IsOnStartCalled,Time=function(){var a={};a.time=0,a.realTime=0,a.deltaTime=0,a.frameCount=0,a.maxDeltaTime=.3333333;var b=0,c=0;return a._update=function(d,e){if(!e){var f=d-b;f=Math.min(a.maxDeltaTime,f),b=d,++a.frameCount,a.deltaTime=f,a.time+=f}a.realTime=d-c},a._restart=function(d){a.time=0,a.realTime=0,a.deltaTime=0,a.frameCount=0,b=d,c=d},a}();Fire.Time=Time;var Event=function(){function a(a,b){"undefined"==typeof b&&(b=!1),this.type=a,this.target=null,this.currentTarget=null,this.eventPhase=0,this.bubbles=b,this._defaultPrevented=!1,this._propagationStopped=!1,this._propagationImmediateStopped=!1}return a.NONE=0,a.CAPTURING_PHASE=1,a.AT_TARGET=2,a.BUBBLING_PHASE=3,a.prototype.stop=function(a){this._propagationStopped=!0,a&&(this._propagationImmediateStopped=!0)},a.prototype.preventDefault=function(){this._defaultPrevented=!0},a.prototype._reset=function(){this.target=null,this.currentTarget=null,this.eventPhase=0,this._defaultPrevented=!1,this._propagationStopped=!1,this._propagationImmediateStopped=!1},a}();Fire.Event=Event;var EventListeners=function(){function a(){Fire._CallbacksHandler.call(this)}return JS.extend(a,Fire._CallbacksHandler),a.prototype.invoke=function(a){var b=this._callbackTable[a.type];if(b&&b.length>0){if(1===b.length)return void b[0](a);for(var c=b.length-1,d=b[c],e=0;c>=e;++e){var f=b[e];if(f(a),a._propagationImmediateStopped||e===c)break;if(b[c]!==d){if(b[c-1]!==d)return void Fire.error("Call event.stop(true) when you remove more than one callbacks in a event callback.");b[e]!==f&&--e,--c}}}},a}(),EventTarget=function(){function a(){HashObject.call(this),this._capturingListeners=null,this._bubblingListeners=null}JS.extend(a,HashObject),a.prototype.on=function(a,b,c){return c="undefined"!=typeof c?c:!1,b?void(c?(this._capturingListeners=this._capturingListeners||new EventListeners,this._capturingListeners.has(a,b)||this._capturingListeners.add(a,b)):(this._bubblingListeners=this._bubblingListeners||new EventListeners,this._bubblingListeners.has(a,b)||this._bubblingListeners.add(a,b))):void Fire.error("Callback of event must be non-nil")},a.prototype.off=function(a,b,c){if(c="undefined"!=typeof c?c:!1,b){var d=c?this._capturingListeners:this._bubblingListeners;d&&d.remove(a,b)}},a.prototype.once=function(a,b,c){var d=this,e=function(f){d.off(a,e,c),b(f)};this.on(a,e,c)};var b=new Array(16);return b.length=0,a.prototype._doDispatchEvent=function(a){a.target=this,this._getCapturingTargets(a.type,b),a.eventPhase=1;var c,d;for(d=b.length-1;d>=0;--d)if(c=b[d],c.isValid&&c._capturingListeners&&(a.currentTarget=c,c._capturingListeners.invoke(a),a._propagationStopped))return;if(b.length=0,(!this.isValid||(this._doSendEvent(a),!a._propagationStopped))&&a.bubbles)for(this._getBubblingTargets(a.type,b),a.eventPhase=3,d=0;d<b.length;++d)if(c=b[d],c.isValid&&c._bubblingListeners&&(a.currentTarget=c,c._bubblingListeners.invoke(a),a._propagationStopped))return},a.prototype.dispatchEvent=function(a){this._doDispatchEvent(a),b.length=0;var c=!a._defaultPrevented;return a._reset(),c},a.prototype._doSendEvent=function(a){a.eventPhase=2,a.currentTarget=this,this._capturingListeners&&(this._capturingListeners.invoke(a),a._propagationStopped)||this._bubblingListeners&&this._bubblingListeners.invoke(a)},a.prototype._getCapturingTargets=function(){},a.prototype._getBubblingTargets=function(){},a}();Fire.EventTarget=EventTarget;var Ticker=function(){var a={},b=60;return window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame,a.requestAnimationFrame=60===b&&window.requestAnimationFrame?function(a){return window.requestAnimationFrame(a)}:function(a){return window.setTimeout(a,1e3/b)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame,a.cancelAnimationFrame=window.cancelAnimationFrame?function(a){window.cancelAnimationFrame(a)}:function(a){window.clearTimeout(a)},a.now=window.performance&&window.performance.now?function(){return window.performance.now()/1e3}:function(){return Date.now()/1e3},a}();!function(){PIXI.dontSayHello=!0;var a=function(){};PIXI.DisplayObject.prototype.updateTransform=a,PIXI.DisplayObject.prototype.displayObjectUpdateTransform=a,PIXI.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=a}();var RenderContext=function(){function a(a,b,c,d){a=a||800,b=b||600,d=d||!1;var e=!1;this.stage=new PIXI.Stage(0),this.root=this.stage,this.renderer=PIXI.autoDetectRenderer(a,b,{view:c,transparent:d,antialias:e}),this.sceneView=null,this.isSceneView=!1,this._camera=null}function b(a){if(a&&a.texture&&a.texture.image){var b=new PIXI.BaseTexture(a.texture.image),d=new PIXI.Rectangle(a.x,a.y,Math.min(b.width-a.x,a.rotatedWidth),Math.min(b.height-a.y,a.rotatedHeight));return new PIXI.Texture(b,d)}return c}var c=new PIXI.Texture(new PIXI.BaseTexture);a.initRenderer=function(a){a._renderObj=null,a._renderObjInScene=null,a._tempMatrix=new Fire.Matrix23},Object.defineProperty(a.prototype,"canvas",{get:function(){return this.renderer.view}}),Object.defineProperty(a.prototype,"size",{get:function(){return new Vec2(this.renderer.width,this.renderer.height)},set:function(a){this.renderer.resize(a.x,a.y)}}),Object.defineProperty(a.prototype,"background",{set:function(a){this.stage.setBackgroundColor(a.toRGBValue())}}),Object.defineProperty(a.prototype,"camera",{get:function(){return this._camera},set:function(a){this._camera=a,Fire.isValid(a)&&(a.renderContext=this)}}),a.prototype.render=function(){this.renderer.render(this.stage)},a.prototype.onRootEntityCreated=function(a){a._pixiObj=this._createNode()},a.prototype._createNode=function(){var a=new PIXI.DisplayObjectContainer;return Engine._canModifyCurrentScene&&this.root.addChild(a),a},a.prototype.onEntityRemoved=function(a){this._removeNode(a._pixiObj),a._pixiObj=null},a.prototype._removeNode=function(a){a&&a.parent&&a.parent.removeChild(a)},a.prototype.onEntityParentChanged=function(a){this._setParentNode(a._pixiObj,a._parent&&a._parent._pixiObj)},a.prototype._setParentNode=function(a,b){a&&(b?b.addChild(a):this.root.addChild(a))},a.prototype._getChildrenOffset=function(a,b){if(a){var c=this.isSceneView?a._pixiObjInScene:a._pixiObj,d=b||a._children[0];if(d){var e=this.isSceneView?d._pixiObjInScene:d._pixiObj,f=c.children.indexOf(e);return-1!==f?f:b?c.children.length:(Fire.error("%s's pixi object not contains in its pixi parent's children",d.name),-1)}return c.children.length}return 0},a.prototype.onEntityIndexChanged=function(a,b,c){var d;0===c&&b>0?d=a.getSibling(1):0===b&&c>0&&(d=a),a._pixiObj&&this._setNodeIndex(a,b,c,d)},a.prototype._setNodeIndex=function(a,b,c,d){var e=this._getChildrenOffset(a._parent,d),f=this.isSceneView?a._pixiObjInScene:a._pixiObj;if(f){var g=f.parent.children;g.splice(b+e,1);var h=c+e;h<g.length?g.splice(h,0,f):g.push(f)}},a.prototype.onSceneLaunched=function(a){this._addToScene(a)},a.prototype._addToScene=function(a){for(var b=a.entities,c=0,d=b.length;d>c;c++){var e=this.isSceneView?b[c]._pixiObjInScene:b[c]._pixiObj;e&&this.root.addChild(e)}},a.prototype.onSceneLoaded=function(a){for(var b=a.entities,c=0,d=b.length;d>c;c++)this.onEntityCreated(b[c],!1)};var d=function(a,b){a._pixiObj=new PIXI.DisplayObjectContainer,a._parent._pixiObj.addChild(a._pixiObj);for(var c=a._children,e=0,f=c.length;f>e;e++)d(c[e],b)};return a.prototype.onEntityCreated=function(a,b){a._pixiObj=new PIXI.DisplayObjectContainer,a._parent?a._parent._pixiObj.addChild(a._pixiObj):b&&this.root.addChild(a._pixiObj);for(var c=a._children,e=0,f=c.length;f>e;e++)d(c[e],this.sceneView)},a.prototype._addSprite=function(a,b){var c=new PIXI.Sprite(a);return b.addChildAt(c,0),c},a.prototype.addSprite=function(a){var c=b(a._sprite),d=!(a.entity._objFlags&HideInGame);d&&(a._renderObj=this._addSprite(c,a.entity._pixiObj)),this.updateSpriteColor(a)},a.prototype.show=function(a,b){a._renderObj&&(a._renderObj.visible=b),a._renderObjInScene&&(a._renderObjInScene.visible=b)},a.prototype.remove=function(a){this._removeNode(a._renderObj),a._renderObj=null},a.prototype.updateSpriteColor=function(a){var b=a._color.toRGBValue();a._renderObj&&(a._renderObj.tint=b)},a.prototype.updateMaterial=function(a){var c=b(a._sprite);a._renderObj&&a._renderObj.setTexture(c)},a.prototype.updateTransform=function(a,b){var c=a._tempMatrix;c.a=b.a,c.b=-b.b,c.c=-b.c,c.d=b.d,c.tx=b.tx,c.ty=this.renderer.height-b.ty,this.isSceneView||a._renderObj&&(a._renderObj.worldTransform=c,a._renderObj.worldAlpha=a._color.a)},a}();Fire._RenderContext=RenderContext,PIXI.BitmapText.prototype.updateTransform=function(){};var PixiBitmapFontUtil={},emptyFont={face:"None",size:1,align:"left"};RenderContext.prototype.getTextSize=function(a){var b=!(a.entity._objFlags&HideInGame),c=0,d=0;return b&&a._renderObj?(c=a._renderObj.textWidth,d=a._renderObj.textHeight):a._renderObjInScene&&(c=a._renderObjInScene.textWidth,d=a._renderObjInScene.textHeight),new Vec2(c,d)},RenderContext.prototype.setText=function(a,b){a._renderObj&&a._renderObj.setText(b),this.sceneView&&a._renderObjInScene.setText(b)},RenderContext.prototype.setAlign=function(a){_setStyle(a)},RenderContext.prototype.setBitmapFont=function(a){_registerFont(a.bitmapFont),_setStyle(a)},RenderContext.prototype.addBitmapText=function(a){_registerFont(a.bitmapFont);var b=_getStyle(a),c=!(a.entity._objFlags&HideInGame);c&&(a._renderObj=new PIXI.BitmapText(a.text,b),a.entity._pixiObj.addChildAt(a._renderObj,0)),this.sceneView&&(a._renderObjInScene=new PIXI.BitmapText(a.text,b),a.entity._pixiObjInScene.addChildAt(a._renderObjInScene,0))},PixiBitmapFontUtil.updateTransform=function(a,b){var c=0,d=null,e=0,f=null,g=Engine._curRenderContext===Engine._renderContext;if(g)for(a._renderObj.dirty&&(a._renderObj.updateText(),a._renderObj.dirty=!1),d=a._renderObj.children,e=d.length;e>c;c++)f=d[c],f.worldTransform=_getNewMatrix23(f,b);else if(a._renderObjInScene)for(a._renderObjInScene.dirty&&(a._renderObjInScene.updateText(),a._renderObjInScene.dirty=!1),d=a._renderObjInScene.children,c=0,e=d.length;e>c;c++)f=d[c],f.worldTransform=_getNewMatrix23(f,b)},Fire._JsonLoader=JsonLoader;var Component=function(){function a(a,b){b?a._objFlags&IsOnEnableCalled||(a._objFlags|=IsOnEnableCalled,a.onEnable&&a.onEnable()):a._objFlags&IsOnEnableCalled&&(a._objFlags&=~IsOnEnableCalled,a.onDisable&&a.onDisable())}var b,c=Fire.extend("Fire.Component",HashObject,b);return c.prop("entity",null,Fire.HideInInspector),c.prop("_enabled",!0,Fire.HideInInspector),Object.defineProperty(c.prototype,"enabled",{get:function(){return this._enabled},set:function(b){this._enabled!=b&&(this._enabled=b,this.entity._activeInHierarchy&&a(this,b))}}),Object.defineProperty(c.prototype,"enabledInHierarchy",{get:function(){return this._enabled&&this.entity._activeInHierarchy}}),Object.defineProperty(c.prototype,"transform",{get:function(){return this.entity.transform}}),c.prototype.update=null,c.prototype.lateUpdate=null,c.prototype.onLoad=null,c.prototype.onStart=null,c.prototype.onEnable=null,c.prototype.onDisable=null,c.prototype.onDestroy=null,c.prototype.onPreRender=null,c.prototype.destroy=function(){FObject.prototype.destroy.call(this)&&this._enabled&&this.entity._activeInHierarchy&&a(this,!1)},c.prototype._onEntityActivated=function(b){this._objFlags&IsOnLoadCalled||(this._objFlags|=IsOnLoadCalled,this.onLoad&&this.onLoad()),this._enabled&&a(this,b)},c._invokeStarts=function(a){for(var b=a._components.length,d=0,e=null;b>d;++d)e=a._components[d],e._objFlags&IsOnStartCalled||(e._objFlags|=IsOnStartCalled,e.onStart&&e.onStart());for(var f=0,g=a._children,h=g.length;h>f;++f){var i=[f];i._active&&c._invokeStarts(i)}},c.prototype._onPreDestroy=function(){a(this,!1),this.onDestroy&&this.onDestroy(),this.entity._removeComponent(this)},c}();Fire.Component=Component,Fire.addComponentMenu=function(){},Fire.executeInEditMode=function(){};var _requiringFrame=[];Fire._RFpush=function(a,b){1===arguments.length&&(b=a,a=""),_requiringFrame.push({uuid:a,script:b})},Fire._RFpop=function(){_requiringFrame.pop()},Fire.defineComponent=function(a){return doDefineComp(Component,a)},Fire.extendComponent=function(a,b){return doDefineComp(a,b)};var Transform=function(){var a=Fire.extend("Fire.Transform",Component,function(){this._position=new Vec2(0,0),this._scale=new Vec2(1,1),this._worldTransform=new Matrix23,this._parent=null});return Fire.executeInEditMode(a),a.prop("_position",null,Fire.HideInInspector),a.prop("_rotation",0,Fire.HideInInspector),a.prop("_scale",null,Fire.HideInInspector),a.getset("position",function(){return new Vec2(this._position.x,this._position.y)},function(a){this._position.x=a.x,this._position.y=a.y},Fire.Tooltip("The local position in its parent's coordinate system")),Object.defineProperty(a.prototype,"x",{get:function(){return this._position.x},set:function(a){this._position.x=a}}),Object.defineProperty(a.prototype,"y",{get:function(){return this._position.y},set:function(a){this._position.y=a}}),Object.defineProperty(a.prototype,"worldPosition",{get:function(){var a=this.getLocalToWorldMatrix();return new Vec2(a.tx,a.ty)},set:function(a){if(this._parent){var b=this._parent.getWorldToLocalMatrix();this.position=b.transformPoint(a)}else this.position=a}}),Object.defineProperty(a.prototype,"worldX",{get:function(){return this.worldPosition.x},set:function(a){if(this._parent){var b=this._parent.getLocalToWorldMatrix(),c=this.getLocalMatrix().prepend(b);c.tx!==a&&(this._position.x=a,this._position.y=c.ty,b.invert().transformPoint(this._position,this._position))}else this._position.x=a}}),Object.defineProperty(a.prototype,"worldY",{get:function(){return this.worldPosition.y},set:function(a){if(this._parent){var b=this._parent.getLocalToWorldMatrix(),c=this.getLocalMatrix().prepend(b);c.ty!==a&&(this._position.x=c.tx,this._position.y=a,b.invert().transformPoint(this._position,this._position))}else this._position.y=a}}),a.getset("rotation",function(){return this._rotation},function(a){this._rotation=a},Fire.Tooltip("The counterclockwise degrees of rotation relative to the parent")),Object.defineProperty(a.prototype,"worldRotation",{get:function(){return this._parent?this.rotation+this._parent.worldRotation:this.rotation},set:function(a){this.rotation=this._parent?a-this._parent.worldRotation:a}}),a.getset("scale",function(){return new Vec2(this._scale.x,this._scale.y)},function(a){this._scale.x=a.x,this._scale.y=a.y},Fire.Tooltip("The local scale factor relative to the parent")),Object.defineProperty(a.prototype,"scaleX",{get:function(){return this._scale.x},set:function(a){this._scale.x=a}}),Object.defineProperty(a.prototype,"scaleY",{get:function(){return this._scale.y},set:function(a){this._scale.y=a}}),Object.defineProperty(a.prototype,"worldScale",{get:function(){var a=this.getLocalToWorldMatrix();return a.getScale()}}),a.prototype.onLoad=function(){this._parent=this.entity._parent&&this.entity._parent.transform},a.prototype.destroy=function(){Fire.error("Not allowed to destroy the transform. Please destroy the entity instead.")},a.prototype._updateTransform=function(a){var b=this._worldTransform;this.getLocalMatrix(b),b.prepend(a);for(var c=this.entity._children,d=0,e=c.length;e>d;d++)c[d].transform._updateTransform(b)},a.prototype._updateRootTransform=function(){var a=this._worldTransform;this.getLocalMatrix(a);for(var b=this.entity._children,c=0,d=b.length;d>c;c++)b[c].transform._updateTransform(a)},a.prototype.getLocalMatrix=function(a){a=a||new Matrix23;var b=.017453292519943295*this._rotation,c=0===this._rotation?0:Math.sin(b),d=0===this._rotation?1:Math.cos(b);return a.a=this._scale.x*d,a.b=this._scale.x*c,a.c=this._scale.y*-c,a.d=this._scale.y*d,a.tx=this._position.x,a.ty=this._position.y,a},a.prototype.getLocalToWorldMatrix=function(a){a=a||new Matrix23,this.getLocalMatrix(a);for(var b=new Fire.Matrix23,c=this._parent;null!==c;c=c._parent)a.prepend(c.getLocalMatrix(b));return a},a.prototype.getWorldToLocalMatrix=function(a){return this.getLocalToWorldMatrix(a).invert()},a.prototype.rotateAround=function(a,b){var c=this.worldPosition.subSelf(a);c.rotateSelf(Math.deg2rad(b)),this.worldPosition=a.addSelf(c),this.rotation=this._rotation+b},Object.defineProperty(a.prototype,"up",{get:function(){return new Vec2(0,1).rotateSelf(Math.deg2rad(this.worldRotation))},set:function(a){if(0===a.x&&0===a.y)return void Fire.warn("Can't get rotation from zero vector");var b=Math.atan2(a.y,a.x)-Math.HALF_PI;this.worldRotation=Math.rad2deg(b)}}),Object.defineProperty(a.prototype,"right",{get:function(){return new Vec2(1,0).rotateSelf(Math.deg2rad(this.worldRotation))},set:function(a){if(0===a.x&&0===a.y)return void Fire.warn("Can't get rotation from zero vector");var b=Math.atan2(a.y,a.x);this.worldRotation=Math.rad2deg(b)}}),a}();Fire.Transform=Transform;var Renderer=function(){function a(a,b,d,e,f){var g=this.getWorldSize(),h=g.x,i=g.y;this.getSelfMatrix(c),a=c.prepend(a);var j=a.tx,k=a.ty,l=a.a*h,m=a.b*h,n=a.c*-i,o=a.d*-i;d.x=j,d.y=k,e.x=l+j,e.y=m+k,b.x=n+j,b.y=o+k,f.x=l+n+j,f.y=m+o+k}var b=Fire.extend("Fire.Renderer",Component),c=new Fire.Matrix23;return b.prototype.getWorldBounds=function(b){var c=this.entity.transform.getLocalToWorldMatrix(),d=new Vec2(0,0),e=new Vec2(0,0),f=new Vec2(0,0),g=new Vec2(0,0);return a.call(this,c,d,e,f,g),b=b||new Rect,Math.calculateMaxRect(b,d,e,f,g),b},b.prototype.getWorldOrientedBounds=function(b,c,d,e){b=b||new Vec2(0,0),c=c||new Vec2(0,0),d=d||new Vec2(0,0),e=e||new Vec2(0,0);var f=this.entity.transform.getLocalToWorldMatrix();return a.call(this,f,b,c,d,e),[b,c,d,e]},b.prototype.getSelfMatrix=function(){},b.prototype.getWorldSize=function(){return new Vec2(0,0)},b}();Fire.Renderer=Renderer;var SpriteRenderer=function(){var a=Fire.extend("Fire.SpriteRenderer",Renderer,function(){RenderContext.initRenderer(this),this._hasRenderObj=!1});Fire.addComponentMenu(a,"SpriteRenderer"),Fire.executeInEditMode(a),a.prop("_sprite",null,Fire.HideInInspector),a.getset("sprite",function(){return this._sprite},function(a){this._sprite=a,this._hasRenderObj&&Engine._renderContext.updateMaterial(this)},Fire.ObjectType(Fire.Sprite)),a.prop("_color",new Fire.Color(1,1,1,1),Fire.HideInInspector),a.getset("color",function(){return this._color},function(a){this._color=a,this._hasRenderObj&&Engine._renderContext.updateSpriteColor(this)}),a.prop("customSize_",!1,Fire.HideInInspector),a.getset("customSize",function(){return this.customSize_},function(a){this.customSize_=a}),a.prop("width_",100,Fire.DisplayName("Width"),Fire.Watch("customSize_",function(a,b){b.disabled=!a.customSize})),a.getset("width",function(){return this.customSize_?this.width_:Fire.isValid(this._sprite)?this._sprite.width:0},function(a){this.width_=a},Fire.HideInInspector),a.prop("height_",100,Fire.DisplayName("Height"),Fire.Watch("customSize_",function(a,b){b.disabled=!a.customSize})),a.getset("height",function(){return this.customSize_?this.height_:Fire.isValid(this._sprite)?this._sprite.height:0},function(a){this.height_=a},Fire.HideInInspector),a.prototype.onLoad=function(){Engine._renderContext.addSprite(this),this._hasRenderObj=!0},a.prototype.onEnable=function(){Engine._renderContext.show(this,!0)},a.prototype.onDisable=function(){Engine._renderContext.show(this,!1)},a.prototype.getWorldSize=function(){return new Fire.Vec2(this.width,this.height)};var b=new Fire.Matrix23;return a.prototype.onPreRender=function(){this.getSelfMatrix(b),this._sprite&&(b.a=this.width/this._sprite.width,b.d=this.height/this._sprite.height,this._sprite.rotated&&(b.b=b.d,b.c=-b.a,b.a=0,b.d=0,b.ty-=this.height)),b.prepend(this.transform._worldTransform),Engine._curRenderContext.updateTransform(this,b)},a.prototype.onDestroy=function(){Engine._renderContext.remove(this)},a.prototype.getSelfMatrix=function(a){var b=this.width,c=this.height,d=.5,e=.5;Fire.isValid(this._sprite)&&(d=this._sprite.pivot.x,e=this._sprite.pivot.y),a.a=1,a.b=0,a.c=0,a.d=1,a.tx=-d*b,a.ty=(1-e)*c},a}();Fire.SpriteRenderer=SpriteRenderer;var BitmapText=function(){var a=function(a){return a[a.left=0]="Left",a[a.center=1]="Center",a[a.right=2]="Right",a}({}),b=function(a){return a[a.topLeft=0]="Top Left",a[a.topCenter=1]="Top Center",a[a.topRight=2]="Top Right",a[a.midLeft=3]="Middle Left",a[a.midCenter=4]="Middle Center",a[a.midRight=5]="Middle Right",a[a.botLeft=6]="Bottom Left",a[a.botCenter=7]="Bottom Center",a[a.botRight=8]="Bottom Right",a}({}),c=Fire.extend("Fire.BitmapText",Renderer,function(){RenderContext.initRenderer(this)});c.TextAlign=a,c.TextAnchor=b,Fire.addComponentMenu(c,"BitmapText"),Fire.executeInEditMode(c),c.prop("_bitmapFont",null,Fire.HideInInspector),c.getset("bitmapFont",function(){return this._bitmapFont},function(a){this._bitmapFont!==a&&(this._bitmapFont=a,this.face=this._bitmapFont?this._bitmapFont.face:"None",Engine._renderContext.setBitmapFont(this))},Fire.ObjectType(Fire.BitmapFont)),c.prop("_text","Text",Fire.HideInInspector),c.getset("text",function(){return this._text},function(a){this._text!==a&&(this._text="string"==typeof a?a:""+a,Engine._renderContext.setText(this,this._text))},Fire.MultiText),c.prop("_anchor",c.TextAnchor.midCenter,Fire.HideInInspector),c.getset("anchor",function(){return this._anchor},function(a){this._anchor!==a&&(this._anchor=a)},Fire.Enum(c.TextAnchor)),c.prop("_align",c.TextAlign.left,Fire.HideInInspector),c.getset("align",function(){return this._align},function(a){this._align!==a&&(this._align=a,Engine._renderContext.setAlign(this,a))},Fire.Enum(c.TextAlign)),c.prototype.onLoad=function(){Engine._renderContext.addBitmapText(this)},c.prototype.onEnable=function(){Engine._renderContext.show(this,!0)
},c.prototype.onDisable=function(){Engine._renderContext.show(this,!1)},c.prototype.onDestroy=function(){Engine._renderContext.remove(this)},c.prototype.getWorldSize=function(){return Engine._renderContext.getTextSize(this)};var d=new Fire.Matrix23;return c.prototype.onPreRender=function(){this.getSelfMatrix(d),d.prepend(this.transform._worldTransform),PixiBitmapFontUtil.updateTransform(this,d)},c.prototype.getSelfMatrix=function(a){var b=Engine._renderContext.getTextSize(this),d=b.x,e=b.y,f=0,g=0;switch(this._anchor){case c.TextAnchor.topLeft:break;case c.TextAnchor.topCenter:f=d*-.5;break;case c.TextAnchor.topRight:f=-d;break;case c.TextAnchor.midLeft:g=.5*e;break;case c.TextAnchor.midCenter:f=d*-.5,g=.5*e;break;case c.TextAnchor.midRight:f=-d,g=.5*e;break;case c.TextAnchor.botLeft:g=e;break;case c.TextAnchor.botCenter:f=d*-.5,g=e;break;case c.TextAnchor.botRight:f=-d,g=e}a.a=1,a.b=0,a.c=0,a.d=1,a.tx=f,a.ty=g},c}();Fire.BitmapText=BitmapText;var Camera=function(){var a=Fire.extend("Fire.Camera",Component,function(){this._renderContext=null});return Fire.addComponentMenu(a,"Camera"),Fire.executeInEditMode(a),a.prop("_background",new Fire.Color(0,0,0),Fire.HideInInspector),a.getset("background",function(){return this._background},function(a){this._background=a,this._renderContext&&(this._renderContext.background=a)}),a.prop("_size",0,Fire.HideInInspector),a.getset("size",function(){return this._size},function(a){this._size=a}),Object.defineProperty(a.prototype,"renderContext",{set:function(a){this._renderContext=a}}),a.prototype.onLoad=function(){this.entity._objFlags&HideInGame||(this.renderContext=Engine._renderContext)},a.prototype.onEnable=function(){this.entity._objFlags&HideInGame||(Engine._scene.camera=this,this._applyRenderSettings())},a.prototype.onDisable=function(){Engine._scene.camera===this&&(Engine._scene.camera=null),this._renderContext.camera=null},a.prototype.viewportToScreen=function(a,b){return b=this._renderContext.size.scale(a,b)},a.prototype.screenToViewport=function(a,b){b=b||new Vec2;var c=this._renderContext.size;return b.x=a.x/c.x,b.y=a.y/c.y,b},a.prototype.viewportToWorld=function(a,b){return b=this.viewportToScreen(a,b),this.screenToWorld(b,b)},a.prototype.screenToWorld=function(a,b){var c=(this._renderContext||Engine._renderContext).size.mulSelf(.5),d=a.sub(c,c);d.y=-d.y;var e=new Matrix23,f=new Vec2;return this._calculateTransform(e,f),e.invert(),e.tx=f.x,e.ty=f.y,e.transformPoint(d,b)},a.prototype.worldToScreen=function(a,b){var c=new Matrix23,d=new Vec2;this._calculateTransform(c,d);var e=a.sub(d,d);b=c.transformPoint(e,b);var f=(this._renderContext||Engine._renderContext).size.y;return b.y=f-b.y,b},a.prototype.worldToViewport=function(a,b){return b=this.worldToScreen(a,b),this.screenToViewport(b,b)},a.prototype._calculateTransform=function(a,b){var c=(this._renderContext||Engine._renderContext).size,d=this._size?c.y/this._size:1,e=this.entity.transform,f=e.getLocalToWorldMatrix();b.x=f.tx,b.y=f.ty,a.identity(),a.tx=.5*c.x,a.ty=.5*c.y,a.a=d,a.d=d,a.rotate(f.getRotation())},a.prototype._applyRenderSettings=function(){this._renderContext.background=this._background},a}();Fire.Camera=Camera;var MissingScript=function(){var a=Fire.extend("Fire.MissingScript",Component);return a.prototype.onLoad=function(){Fire.warn("The referenced script on this Component is missing!")},a}();Fire._MissingScript=MissingScript;var InteractionContext=function(){function a(){this.entities=[]}var b={},c={};return a.prototype._clear=function(){this.entities.length=0},a.prototype.pick=function(a){for(var d=this.entities.length-1;d>=0;--d){var e=this.entities[d];if(e.isValid){var f=b[e.id];if(f.contains(a)){var g=c[e.id],h=new Fire.Polygon(g);if(h.contains(a))return e}}}return null},a.prototype._updateRecursilvey=function(a){var d=a.getComponent(Fire.Renderer);if(d&&d._enabled){this.entities.push(a);var e=a.id;if(!c[e]){var f=d.getWorldOrientedBounds(),g=Math.calculateMaxRect(new Rect,f[0],f[1],f[2],f[3]);c[e]=f,b[e]=g}}for(var h=0,i=a._children.length;i>h;++h){var j=a._children[h];j._active&&this._updateRecursilvey(j)}},a.prototype.update=function(a){var d=!Engine.isPlaying||this===Engine._interactionContext;d&&(b={},c={}),this._clear();for(var e=0,f=a.length;f>e;++e){var g=a[e];g._active&&this._updateRecursilvey(g)}},a.prototype.getAABB=function(a){return b[a.id]},a.prototype.getOBB=function(a){return c[a.id]},a}();Fire._InteractionContext=InteractionContext;var Entity=function(){var a=Fire.extend("Fire.Entity",EventTarget,function(){var b=arguments[0];if(this._name="undefined"!=typeof b?b:"New Entity",this._objFlags|=a._defaultFlags,Fire._isCloning)this._activeInHierarchy=!1;else{this._activeInHierarchy=!0;var c=new Transform;c.entity=this,this._components=[c],this.transform=c,Engine._scene&&Engine._scene.appendRoot(this),Engine._renderContext.onRootEntityCreated(this),c._onEntityActivated(!0)}});return a.prop("_active",!0,Fire.HideInInspector),a.prop("_parent",null,Fire.HideInInspector),a.prop("_children",[],Fire.HideInInspector),a.prop("_components",null,Fire.HideInInspector),a.prop("transform",null,Fire.HideInInspector),a.getset("name",function(){return this._name},function(a){this._name=a}),a.getset("active",function(){return this._active},function(a){if(this._active!=a){this._active=a;var b=!this._parent||this._parent._activeInHierarchy;b&&this._onActivatedInHierarchy(a)}}),Object.defineProperty(a.prototype,"parent",{get:function(){return this._parent},set:function(b){if(this._parent!==b){if(b===this)return void Fire.warn("A entity can't be set as the parent of itself.");if(b&&!(b instanceof a))return void Fire.error(b instanceof Transform?"Entity.parent can not be a Transform, use transform.entity instead.":"Entity.parent must be instance of Entity (or must be null)");var c=this._parent;if(b){if(b._objFlags&HideInGame&&!(this._objFlags&HideInGame))return void Fire.error("Failed to set parent, the child's HideInGame must equals to parent's.");if(b._objFlags&HideInEditor&&!(this._objFlags&HideInEditor))return void Fire.error("Failed to set parent, the child's HideInEditor must equals to parent's.");c||Engine._scene.removeRoot(this),b._children.push(this)}else Engine._scene.appendRoot(this);this._parent=b||null,this.transform._parent=this._parent&&this._parent.transform,!c||c._objFlags&Destroying||(c._children.splice(c._children.indexOf(this),1),this._onHierarchyChanged(c)),Engine._renderContext.onEntityParentChanged(this,c)}}}),Object.defineProperty(a.prototype,"childCount",{get:function(){return this._children.length}}),a._defaultFlags=0,a.find=function(a){return a||""===a?"/"!==a[0]?void Fire.error("Path must start with a '/' character"):Engine._scene.findEntity(a):void Fire.error("Argument must be non-nil")},Object.defineProperty(a.prototype,"activeInHierarchy",{get:function(){return this._activeInHierarchy}}),a.prototype.destroy=function(){FObject.prototype.destroy.call(this)&&this._activeInHierarchy&&this._deactivateChildComponents()},a.prototype._onPreDestroy=function(){var a=this._parent;this._objFlags|=Destroying;var b=!(a&&a._objFlags&Destroying);b&&Engine._renderContext.onEntityRemoved(this);for(var c=0;c<this._components.length;++c){var d=this._components[c];d._destroyImmediate()}a?b&&a._children.splice(a._children.indexOf(this),1):Engine._scene.removeRoot(this);for(var e=this._children,f=0,g=e.length;g>f;++f)e[f]._destroyImmediate()},a.prototype._getCapturingTargets=function(a,b){for(var c=this._parent;c;c=c._parent)c._activeInHierarchy&&c._capturingListeners&&c._capturingListeners.has(a)&&b.push(c)},a.prototype._getBubblingTargets=function(a,b){for(var c=this._parent;c;c=c._parent)c._activeInHierarchy&&c._bubblingListeners&&c._bubblingListeners.has(a)&&b.push(c)},a.prototype._doSendEvent=function(b){this._activeInHierarchy&&a.$super.prototype._doSendEvent.call(this,b)},a.prototype.addComponent=function(a){var b;if(b="string"==typeof a?JS.getClassByName(a):a,this._objFlags&Destroying)return void Fire.error("isDestroying");if(!b)return void Fire.error("Argument must be non-nil");if("function"!=typeof b)return void Fire.error("The component to add must be a constructor");var c=new b;return c.entity=this,this._components.push(c),this._activeInHierarchy&&c._onEntityActivated(!0),c},a.prototype.getComponent=function(a){if(!a)return void Fire.error("Argument must be non-nil");var b;b="string"==typeof a?JS.getClassByName(a):a;for(var c=0;c<this._components.length;++c){var d=this._components[c];if(d instanceof b)return d}return null},a.prototype._removeComponent=function(a){if(!(this._objFlags&Destroying)){var b=this._components.indexOf(a);-1!==b?(this._components.splice(b,1),a.entity=null):a.entity!==this&&Fire.error("Component not owned by this entity")}},a.prototype.find=function(a){if(!a&&""!==a)return void Fire.error("Argument must be non-nil");if("/"===a[0])return void Fire.error("Path should not start with a '/' character, please use \"Fire.Entity.find\" instead");for(var b=a.split("/"),c=this,d=0,e=0,f=null,g=null,h=0;h<b.length;h++){var i=b[h];if(".."===i){if(!c)return null;c=c._parent}else{for(f=c?c._children:Engine._scene.entities,c=null,d=0,e=f.length;e>d;++d)g=f[d],g.name===i&&(c=g);if(!c)return null}}return c},a.prototype.getChild=function(a){return this._children[a]},a.prototype.isChildOf=function(a){var b=this;do{if(b===a)return!0;b=b._parent}while(b);return!1},a.prototype.getSiblingIndex=function(){return this._parent?this._parent._children.indexOf(this):Engine._scene.entities.indexOf(this)},a.prototype.getSibling=function(a){return this._parent?this._parent._children[a]:Engine._scene.entities[a]},a.prototype.setSiblingIndex=function(a){var b=this._parent?this._parent._children:Engine._scene.entities,c=this;a=-1!==a?a:b.length-1;var d=b.indexOf(c);a!==d&&(b.splice(d,1),a<b.length?b.splice(a,0,c):b.push(c),Engine._renderContext.onEntityIndexChanged(this,d,a))},a.prototype.setAsFirstSibling=function(){this.setSiblingIndex(0)},a.prototype.setAsLastSibling=function(){this.setSiblingIndex(-1)},a.prototype._onActivatedInHierarchy=function(a){this._activeInHierarchy=a;for(var b=this._components.length,c=0;b>c;++c){var d=this._components[c];d._onEntityActivated(a)}for(var e=0,f=this.childCount;f>e;++e){var g=this._children[e];g._active&&g._onActivatedInHierarchy(a)}},a.prototype._deactivateChildComponents=function(){for(var a=this._components.length,b=0;a>b;++b){var c=this._components[b];c._onEntityActivated(!1)}for(var d=0,e=this.childCount;e>d;++d){var f=this._children[d];f._active&&f._deactivateChildComponents()}},a.prototype._onHierarchyChanged=function(a){var b=this._active&&(!a||a._activeInHierarchy),c=this._active&&(!this._parent||this._parent._activeInHierarchy);b!==c&&this._onActivatedInHierarchy(c)},a.prototype._instantiate=function(a,b){var c=this._parent;this._parent=null;var d=Fire._doInstantiate(this);return this._parent=c,Engine.isPlaying&&(d._name=this._name+"(Clone)"),a&&(d.transform._position=a),b&&(d.transform._rotation=b),Engine._scene&&Engine._scene.appendRoot(d),Engine._renderContext.onEntityCreated(d,!0),d._active&&d._onActivatedInHierarchy(!0),d},a}();Fire.Entity=Entity;var Scene=function(){function Scene(){_super.call(this),this.entities=[],this.camera=null}var _super=Asset;JS.extend(Scene,_super),JS.setClassName("Fire.Scene",Scene);var visitOperationTmpl="if(c._enabled && c._FUNC_) c._FUNC_();",visitFunctionTmpl="(function(e){	var i, len=e._components.length;	for(i=0;i<len;++i){		var c=e._components[i];		"+visitOperationTmpl+"	}	var cs=e._children;	for(i=0,len=cs.length;i<len;++i){		var sub=cs[i];		if(sub._active) _FUNC_Recursively(sub);	}})",updateRecursively=eval(visitFunctionTmpl.replace(/_FUNC_/g,"update")),lateUpdateRecursively=eval(visitFunctionTmpl.replace(/_FUNC_/g,"lateUpdate")),onPreRenderRecursively=eval(visitFunctionTmpl.replace(/_FUNC_/g,"onPreRender"));return Scene.prototype.update=function(){for(var a=this.entities,b=0,c=a.length;c>b;++b)Component._invokeStarts(a[b]);for(b=0,c=a.length;c>b;++b)a[b]._active&&updateRecursively(a[b]);for(b=0,c=a.length;c>b;++b)a[b]._active&&lateUpdateRecursively(a[b])},Scene.prototype.render=function(a){Engine._curRenderContext=a,this.updateTransform(a.camera||this.camera);for(var b=this.entities,c=0,d=b.length;d>c;++c)b[c]._active&&onPreRenderRecursively(b[c]);a.render(),Engine._curRenderContext=null},Scene.prototype.updateTransform=function(a){var b,c,d=this.entities;if(a){var e=new Matrix23,f=new Vec2;a._calculateTransform(e,f);var g=-f.x,h=-f.y;for(b=0,c=d.length;c>b;++b){var i=d[b].transform._position,j=i.x,k=i.y;i.x+=g,i.y+=h,d[b].transform._updateTransform(e),i.x=j,i.y=k}}else for(b=0,c=d.length;c>b;++b)d[b].transform._updateRootTransform()},Scene.prototype.appendRoot=function(a){this.entities.push(a)},Scene.prototype.removeRoot=function(a){var b=this.entities;if(b.length>0&&b[b.length-1]===a)return void b.pop();var c=b.indexOf(a);-1!==c?b.splice(c,1):Fire.error("entity "+a+" not contains in roots of hierarchy, is may caused if entity not destroyed immediate before current scene changed")},Scene.prototype.findEntity=function(a){for(var b=a.split("/"),c=null,d=b[1],e=this.entities,f=0;f<e.length;f++)if(e[f].isValid&&e[f]._name===d){c=e[f];break}if(!c)return null;var g=2;for(g;g<b.length;g++){d=b[g];var h=c._children;c=null;for(var i=0,j=h.length;j>i;++i){var k=h[i];if(k.name===d){c=k;break}}if(!c)return null}return c},Scene.prototype.activate=function(){for(var a=this.entities,b=0,c=a.length;c>b;++b){var d=a[b];d._active&&d._onActivatedInHierarchy(!0)}if(Engine.isPlaying)for(b=0,c=a.length;c>b;++b)Component._invokeStarts(a[b])},Scene.prototype.destroy=function(){for(var a=this.entities,b=0,c=a.length;c>b;++b){var d=a[b];d.isValid&&d.destroy()}_super.prototype.destroy.call(this)},Scene.prototype._instantiate=function(){var a=this._uuid,b=Fire._doInstantiate(this);return b._uuid=a,b},Scene}();Fire._Scene=Scene;var LoadManager=function(){function a(){return{image:{loader:ImageLoader,defaultExtname:".host"},json:{loader:JsonLoader,defaultExtname:".json"},text:{loader:TextLoader,defaultExtname:".txt"}}}function b(a,b,c){f._curConcurrent+=1,a(b,function(a,b){c(a,b),f._curConcurrent=Math.max(0,f._curConcurrent-1),e()})}var c=new Fire.CallbacksInvoker,d=[],e=function(){if(f._curConcurrent>=f.maxConcurrent)return void Fire.error("too many concurrent requests");var a=d.pop();a&&b(a.loader,a.url,a.callback)},f={maxConcurrent:2,_curConcurrent:0,loadByLoader:function(a,e,f){if(c.add(e,f)){var g=c.bindKey(e,!0);this._curConcurrent<this.maxConcurrent?b(a,e,g):d.push({url:e,loader:a,callback:g})}},load:function(a,b,c,d){"function"==typeof c&&(d=c);var e=this._rawTypes[b];if(e){var f=c?"."+c:e.defaultExtname;if(f){var g=a+f;this.loadByLoader(e.loader,g,d)}else d("Undefined extname for the raw "+b+" file of "+a,null)}else d('Unknown raw type "'+b+'" of '+a,null)},_rawTypes:a(),registerRawTypes:function(a,b,c){return this._rawTypes[a]?void Fire.error('rawType "%s" has already defined',a):(c&&"."!==c[0]&&(c="."+c),void(this._rawTypes[a]={loader:b,defaultExtname:c}))},_loadFromXHR:_LoadFromXHR};return f._urlToCallbacks=c,f}();Fire.LoadManager=LoadManager;var AssetLibrary=function(){var a={},b="",c=new Fire.CallbacksInvoker,d={_loadAssetByUuid:function(e,f,g,h,i){if(g="undefined"!=typeof g?g:!1,"string"!=typeof e)return void f("[AssetLibrary] uuid must be string",null);if(!i){var j=d._uuidToAsset[e];if(j)return void(f&&f(null,j))}if(g||i||c.add(e,f)!==!1){var k=a&&a[e];k||(k=b+e.substring(0,2)+Fire.Path.sep+e),LoadManager.loadByLoader(JsonLoader,k,function(a,b){return a?void(g?f(a,null):c.invokeAndRemove(e,a,null)):void d.loadJson(b,k,function(a,b){b._uuid=e,g?f(a,b):(d._uuidToAsset[e]=b,c.invokeAndRemove(e,a,b))},g,h,i)})}},loadJson:function(a,b,c,e,f,g){f?f.reset():f=new Fire._DeserializeInfo,Engine._canModifyCurrentScene=!1;var h=a&&a[0]&&a[0].__type__===JS._getClassId(Scene),i=Fire.deserialize(a,f,{classFinder:h?Fire._MissingScript.safeFindClass:function(a){var b=JS._getClassById(a);return b?b:(Fire.warn('Can not get class "%s"',a),Object)},target:g});Engine._canModifyCurrentScene=!0;var j=f.uuidList.length,k=f.rawProp;if(k){var l=Fire.attr(i.constructor,f.rawProp),m=l.rawType;++j,LoadManager.load(b,m,i._rawext,function(a,d){a&&Fire.error("[AssetLibrary] Failed to load %s of %s. %s",m,b,a),i[k]=d,--j,0===j&&c(null,i)})}if(0===j)return void c(null,i);for(var n=0,o=f.uuidList.length;o>n;n++){var p=f.uuidList[n],q=function(a,b,d){return function(e,f){e||(f._uuid=a),b[d]=f,--j,0===j&&c(null,i)}}(p,f.uuidObjList[n],f.uuidPropList[n]);d._loadAssetByUuid(p,q,e,f)}},loadAsset:function(a,b){this._loadAssetByUuid(a,b,!0,null)},getAssetByUuid:function(a){return d._uuidToAsset[a]||null},unloadAsset:function(a,b){var c;c="string"==typeof a?d._uuidToAsset[a]:a,c&&(b&&c.isValid&&(c.destroy(),FObject._deferredDestroy()),delete d._uuidToAsset[c._uuid])},init:function(c,d){b=Fire.Path.setEndWithSep(c),a=d}};return d._uuidToAsset={},Asset.prototype._onPreDestroy=function(){d._uuidToAsset[this._uuid]===this&&d.unloadAsset(this,!1)},d}();Fire.AssetLibrary=AssetLibrary;var Engine=function(){function a(){d._scene.render(d._renderContext)}function b(b){d._scene&&(b&&(d._scene.update(),FObject._deferredDestroy()),a(),d._interactionContext.update(d._scene.entities))}function c(){if(e&&(i=Ticker.requestAnimationFrame(c),!h)){var a=!f||g;g=!1;var d=Ticker.now();Time._update(d,!a),b(a)}}var d={},e=!1,f=!1,g=!1,h=!1,i=-1;d._scene=null,d._renderContext=null,d._interactionContext=null,d._curRenderContext=null,d._inputContext=null,Object.defineProperty(d,"isPlaying",{get:function(){return e}}),Object.defineProperty(d,"isPaused",{get:function(){return f}}),Object.defineProperty(d,"isLoadingScene",{get:function(){return h}});var j=null;Object.defineProperty(d,"_canModifyCurrentScene",{get:function(){return!j},set:function(a){a?(this._scene=j,j=null):(this._scene&&j&&Fire.error("another scene still locked: "+j.name),j=this._scene,this._scene=null)}}),Object.defineProperty(d,"screenSize",{get:function(){return d._renderContext.size},set:function(a){d._renderContext.size=a}});var k=!1;return Object.defineProperty(d,"inited",{get:function(){return k}}),d.init=function(a,b,c){return k?void Fire.error("Engine already inited"):(k=!0,d._renderContext=new RenderContext(a,b,c),d._interactionContext=new InteractionContext,d._renderContext)},d.play=function(){if(e&&!f)return void Fire.warn("Fireball is already playing");if(e&&f)return void(f=!1);e=!0,d._inputContext=new InputContext(d._renderContext);var a=Ticker.now();Time._restart(a),c()},d.stop=function(){e&&(FObject._deferredDestroy(),d._inputContext.destruct(),d._inputContext=null,Input._reset()),e=!1,f=!1,h=!1,-1!==i&&(Ticker.cancelAnimationFrame(i),i=-1)},d.pause=function(){f=!0},d.step=function(){this.pause(),g=!0,e||d.play()},d.update=c,d._setCurrentScene=function(a,b){if(!a)return void Fire.error("Argument must be non-nil");var c=d._scene;Fire.isValid(c)&&AssetLibrary.unloadAsset(c,!0),FObject._deferredDestroy(),d._scene=null,b&&b(),d._renderContext.onSceneLoaded(a),d._scene=a,d._renderContext.onSceneLaunched(a),a.activate()},d.loadScene=function(a,b,c){h=!0,AssetLibrary.unloadAsset(a),AssetLibrary._loadAssetByUuid(a,function(e,f){return e?(Fire.error("Failed to load scene: "+e),h=!1,void(b&&b(null,e))):f instanceof Fire._Scene?(d._setCurrentScene(f,c),h=!1,void(b&&b(f))):(e="The asset "+a+" is not a scene",Fire.error(e),h=!1,void(b&&b(null,e)))})},d}();Fire.Engine=Engine;var ModifierKeyStates=function(){function a(a){Fire.Event.call(this,a,!0),this.nativeEvent=null,this.ctrlKey=!1,this.shiftKey=!1,this.altKey=!1,this.metaKey=!1}return JS.extend(a,Fire.Event),a.prototype.getModifierState=function(a){return nativeEvent.getModifierState(a)},a.prototype.initFromNativeEvent=function(a){this.nativeEvent=a,this.ctrlKey=a.ctrlKey,this.shiftKey=a.shiftKey,this.altKey=a.altKey,this.metaKey=a.metaKey},a.prototype._reset=function(){Event.prototype._reset.call(this),this.nativeEvent=null,this.ctrlKey=!1,this.shiftKey=!1,this.altKey=!1,this.metaKey=!1},a}();Fire.ModifierKeyStates=ModifierKeyStates,Fire.KeyboardEvent=KeyboardEvent;var MouseEvent=function(){function a(a){Fire.ModifierKeyStates.call(this,a),this.button=0,this.buttonStates=0,this.screenX=0,this.screenY=0,this.deltaX=0,this.deltaY=0,this.relatedTarget=null}return JS.extend(a,ModifierKeyStates),window.TouchEvent,a.prototype.initFromNativeEvent=function(a){ModifierKeyStates.prototype.initFromNativeEvent.call(this,a),this.button=a.button,this.buttonStates=a.buttons,this.screenX=a.offsetX,this.screenY=a.offsetY,this.deltaX=a.movementX,this.deltaY=a.movementY,this.relatedTarget=a.relatedTarget},a.prototype._reset=function(){ModifierKeyStates.prototype._reset.call(this),this.button=0,this.buttonStates=0,this.screenX=0,this.screenY=0,this.deltaX=0,this.deltaY=0,this.relatedTarget=null},a}();Fire.MouseEvent=MouseEvent;var InputContext=function(){function a(a){this.target=a,this.events=[]}a.prototype.addEventListener=function(a,b,c){this.target.addEventListener(a,b,c),this.events.push([a,b,c])},a.prototype.removeAll=function(){for(var a=0;a<this.events.length;a++){var b=this.events[a];this.target.removeEventListener(b[0],b[1],b[2])}this.events.length=0};var b=function(b){function c(a){f.onDomInputEvent(a)}function d(){e.focus()}var e=b.renderer.view;e.tabIndex=e.tabIndex||0,this.renderContext=b,this.eventRegister=new a(e),this.hasTouch="ontouchstart"in window;var f=this;for(var g in EventRegister.inputEvents)this.eventRegister.addEventListener(g,c,!0);this.hasTouch&&this.simulateMouseEvent(),this.hasTouch?this.eventRegister.addEventListener("touchstart",d,!0):this.eventRegister.addEventListener("mousedown",d,!0)};return b.prototype.simulateMouseEvent=function(){function a(a,b){var c=new MouseEvent(a);c.bubbles=!0;var f=b.touches[0];return c.button=0,c.buttonStates=1,f&&(c.screenX=f.pageX-d,c.screenY=f.pageY-e),c}function b(b){var d=b.simulateType;return d?function(b){var e=a(d,b);Input._dispatchEvent(e,c),b.preventDefault(),e._propagationStopped&&(e._propagationImmediateStopped?b.stopImmediatePropagation():b.stopPropagation())}:function(a){a.preventDefault()}}for(var c=this,d=0,e=0,f=c.renderContext.renderer.view;f;)d+=parseInt(f.offsetLeft),e+=parseInt(f.offsetTop),f=f.offsetParent;var g={touchstart:{simulateType:"mousedown"},touchend:{simulateType:"mouseup"},touchmove:{simulateType:"mousemove"},touchcancel:{simulateType:""}};for(var h in g){var i=g[h];this.eventRegister.addEventListener(h,b(i),!0)}},b.prototype.destruct=function(){this.eventRegister.removeAll()},b.prototype.onDomInputEvent=function(a){var b=EventRegister.inputEvents[a.type],c=new b.constructor(a.type);c.initFromNativeEvent&&c.initFromNativeEvent(a),c.bubbles=b.bubbles,Input._dispatchEvent(c,this),c._defaultPrevented&&a.preventDefault(),c._propagationStopped&&(c._propagationImmediateStopped?a.stopImmediatePropagation():a.stopPropagation())},b}(),EventRegister={inputEvents:{keydown:{constructor:KeyboardEvent,bubbles:!0,cancelable:!0},keyup:{constructor:KeyboardEvent,bubbles:!0,cancelable:!0},click:{constructor:MouseEvent,bubbles:!0,cancelable:!0},dblclick:{constructor:MouseEvent,bubbles:!0,cancelable:!1},mousedown:{constructor:MouseEvent,bubbles:!0,cancelable:!0},mouseup:{constructor:MouseEvent,bubbles:!0,cancelable:!0},mousemove:{constructor:MouseEvent,bubbles:!0,cancelable:!0}}};Fire.EventRegister=EventRegister;var Input=function(){var a={_eventListeners:new EventListeners};return a.on=function(a,b){b?this._eventListeners.add(a,b):Fire.error("Callback must be non-nil")},a.off=function(a,b){b?this._eventListeners.remove(a,b)||Fire.warn("Callback not exists"):Fire.error("Callback must be non-nil")},a._reset=function(){this._eventListeners=new EventListeners},a._dispatchMouseEvent=function(a,b){var c=b.renderContext.camera||Engine._scene.camera,d=c.screenToWorld(new Vec2(a.screenX,a.screenY)),e=Engine._interactionContext.pick(d);e&&e.dispatchEvent(a)},a._dispatchEvent=function(a,b){this._eventListeners.invoke(a),a instanceof Fire.MouseEvent&&this._dispatchMouseEvent(a,b)},a}();Fire.Input=Input,"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=Fire),exports.Fire=Fire):"undefined"!=typeof define&&define.amd?define(Fire):root.Fire=Fire}).call(this);